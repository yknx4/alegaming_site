{"version":3,"sources":["util/streamlabs.ts","util/fb.ts","datastore/messagesDatabase.ts","util/messages.ts","live_videos/VideoHeader.tsx","PageContext.ts","live_videos/util.tsx","live_videos/Notifies.tsx","LiveVideoDashboard.tsx","PageSelector.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["InvalidChatboxUrlError","Error","useChatBoxUrlState","createPersistedState","STARTS","isValidUrl","storedUrl","JSON","parse","window","localStorage","getItem","console","log","error","startsWith","storedConfig","fetchStreamlabsConfig","a","fetch","headers","response","ok","json","config","getUserToken","streamlabsConfig","oauths","facebook_account","getUserId","usernames","getPagesTokens","pageAccessTokensResponse","getPageToken","id","tokens","data","find","t","usePersistedVideoData","FbApiCall","path","params","method","Promise","resolve","reject","FB","api","errorResponse","message","getAllResults","results","allResults","push","undefined","paging","next","nextResponse","messagesDatabase","messages","version","stores","table","Dexie","videoCommentToDbMessage","videoId","pageId","toString","createdTime","created_time","user","from","name","userPicture","picture","url","userId","broadcastTimestamp","live_broadcast_timestamp","likeCount","like_count","dbMessageToVideoComment","Date","toISOString","batchInsertApiMessages","dbMessages","map","m","bulkAdd","Paragraph","Typography","Content","children","extraContent","style","flex","className","VideoHeader","props","liveVideo","history","useHistory","videoTime","DateTime","fromISO","creation_time","title","onBack","goBack","subTitle","toLocaleString","DATETIME_MED","tags","color","status","extra","key","type","target","href","permalink_url","avatar","src","video","icon","alt","width","description","PageContext","createContext","formatComments","comments","c","date","actions","author","content","datetime","TIME_24_WITH_SECONDS","toRelative","defaultVideoCustomState","useVideoCustomState","memoize","notifyActions","state","setMessageState","down","onClick","createElement","ArrowUpOutlined","ArrowDownOutlined","hidden","React","EyeOutlined","EyeInvisibleOutlined","defaultMessageState","formatNotifies","videoState","setVideoState","messageId","messageState","prevState","currentMessageState","newMessageState","TIME_WITH_SECONDS","NotifiesList","perPage","text","useParams","useState","currentPage","setPage","offset","header","length","itemLayout","dataSource","slice","renderItem","item","current","onChange","p","total","showSizeChanger","defaultPageSize","showTotal","range","defaultCurrent","Layout","defaultMessageParams","limit","live_filter","order","fields","VideoCard","span","LoadingOutlined","VideoCameraOutlined","bordered","hoverable","cover","Meta","CurrentVideos","videos","margin","Item","padding","minHeight","gutter","v","loadCachedMessages","where","toArray","existingMessages","CommentsList","CommentsFeed","page","useContext","loaded","setLoaded","roundSize","setRoundSize","setComments","useEffect","since","effect","sortBy","toMillis","reverse","access_token","interval","setInterval","newComments","prev","uniqBy","clearInterval","notifies","filter","includes","toLowerCase","filteredNotifies","currentState","withoutHiddenAndMoved","n","movedDown","generateNotifiesForRound","defaultValue","tooltipVisible","value","i","round","printRoundLine","LiveVideoDashboard","persistedVideoData","setPersistedVideoData","loading","setLoading","to","LiveVideosDashboard","loadingVideos","setLoadingVideos","setVideos","pageData","setPageData","tokenItem","match","useRouteMatch","Provider","size","CollectionCreateForm","visible","onCreate","onCancel","chatboxUrl","Form","useForm","form","okText","cancelText","onOk","validateFields","then","values","resetFields","catch","info","layout","initialValues","label","rules","required","addonAfter","SettingOutlined","placeholder","UpdateChatboxUrl","setVisible","setChatboxUrl","PageSelector","Footer","Sider","SubMenu","Menu","getSelectedMenuItemKey","split","Sidebar","showPageSelector","pages","setPages","tokensResponse","collapsed","setCollapsed","useLocation","collapsible","onCollapse","theme","defaultSelectedKeys","mode","selectedKeys","pathname","DashboardOutlined","FacebookOutlined","UnorderedListOutlined","App","loggedIn","setLoggedIn","basename","textAlign","Boolean","location","hostname","fbAsyncInit","init","appId","autoLogAppEvents","xfbml","cookie","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.e2d2bb61.chunk.js","sourcesContent":["import { last } from 'lodash'\nimport createPersistedState from 'use-persisted-state'\nimport { StreamLabsConfig } from './streamlabs.definitions'\n\nexport class InvalidChatboxUrlError extends Error {}\n\nexport const useChatBoxUrlState = createPersistedState('chatboxUrl')\n\nconst STARTS = 'https://streamlabs.com/widgets/chat-box/v1/'\nexport function isValidUrl() {\n  const storedUrl = JSON.parse(window.localStorage.getItem('chatboxUrl') ?? '\"\"')\n  console.log('storedUrl', storedUrl)\n  if (storedUrl === null) {\n    console.error('storedUrl is null')\n    return false\n  }\n  if (!storedUrl.startsWith(STARTS)) {\n    console.error(`storedUrl <${storedUrl}> doesn't start with <${STARTS}>.`)\n    return false\n  }\n  return true\n}\n\nexport function getStreamlabsToken() {\n  return new Promise<string>((resolve, reject) => {\n    if (isValidUrl()) {\n      const url = JSON.parse(window.localStorage.getItem('chatboxUrl') ?? '\"\"') as string\n      resolve(last(url.split('/')))\n    } else {\n      reject(new InvalidChatboxUrlError('localStorage.chatboxUrl is empty or invalid.'))\n    }\n  })\n}\n\nlet storedConfig: StreamLabsConfig | null = null\nexport async function fetchStreamlabsConfig() {\n  if (storedConfig !== null) {\n    return storedConfig\n  }\n  const storedUrl = JSON.parse(window.localStorage.getItem('chatboxUrl') ?? '\"\"')\n  const response = await fetch(`https://murmuring-plateau-21894.herokuapp.com/?url=${storedUrl}`, {\n    headers: {\n      'x-token': 'eQ1z8bmURCR2Odtg4NR8M'\n    }\n  })\n  if (!response.ok) {\n    throw new InvalidChatboxUrlError('localStorage.chatboxUrl is empty or invalid.')\n  }\n  const config = (await response.json()) as StreamLabsConfig\n  storedConfig = config\n  return config\n}\n","import createPersistedState from \"use-persisted-state\"\nimport { PageTokensResponse } from \"../definitions\"\nimport { FacebookPaginatedResponse } from \"./fb.definitions\"\nimport { fetchStreamlabsConfig } from \"./streamlabs\"\n\nexport class InvalidFacebookUserTokenError extends Error {}\nexport class InvalidFacebookPageTokenError extends Error {}\n\n\nexport interface FacebookMe {\n  name: string\n}\n\nexport interface HasError {\n  error: any\n}\n\nexport async function getUserToken(): Promise<string> {\n  const streamlabsConfig = await fetchStreamlabsConfig()\n  return streamlabsConfig.oauths.facebook_account\n}\n\nexport async function getUserId(): Promise<string> {\n  const streamlabsConfig = await fetchStreamlabsConfig()\n  return streamlabsConfig.usernames.facebook_account\n}\n\nexport async function getPagesTokens(): Promise<PageTokensResponse> {\n  const pageAccessTokensResponse = await fetch(`https://graph.facebook.com/${await getUserId()}/accounts?access_token=${await getUserToken()}`)\n  return pageAccessTokensResponse.json() \n}\n\nexport async function getPageToken(id: string) {\n  const tokens = await getPagesTokens()\n  return tokens.data.find(t => t.id === id)\n}\n\nexport type PersistedVideoData = Record<string, boolean>\nexport const usePersistedVideoData = createPersistedState('persistedVideoData')\n\ninterface FbError {\n  error: string | unknown\n}\n\nexport interface FbParams {\n  access_token: string;\n  fields: string;\n  limit?: number\n  live_filter?: 'no_filter' | 'filter_low_quality'\n  order?: 'chronological' | 'reverse_chronological'\n  since?: string\n}\n\nexport function FbApiCall<T = unknown>(path: string, params: FbParams, method: \"get\" | \"post\" | \"delete\" = 'get'): Promise<T> {\n  return new Promise((resolve, reject) => {\n    FB.api(\n      path,\n      method,\n      params,\n      function (response: T | FbError | undefined) {\n        if(response == null) {\n          reject(new Error('Empty Response'))\n        }\n        if((response as FbError).error != null) {\n          const errorResponse = response as FbError\n          const message = typeof errorResponse.error === 'string' ? errorResponse.error : 'FB Api Error'\n          console.error(response)\n          reject(new Error(message))\n        }\n        resolve(response as T)\n      }\n    );\n  })\n}\n\nexport async function getAllResults<T extends FacebookPaginatedResponse>(results: T) {\n  let allResults: T['data'] = []\n\n  allResults.push(...results.data)\n  while (results.paging?.next !== undefined) {\n    const nextResponse = await fetch(results.paging.next)\n    results = await nextResponse.json()\n    allResults.push(...results.data)\n  }\n  return allResults\n}","import Dexie from 'dexie';\n\nexport interface Message {\n  id?: string;\n  message?: string;\n  createdTime?: string;\n  broadcastTimestamp?: number;\n  user?: string\n  userId?: string\n  userPicture?: string\n  pageId?: string\n  videoId?: string\n  likeCount?: number\n}\n\n//\n// Declare Database\n//\nclass MessageDatabase extends Dexie {\n  public messages: Dexie.Table<Message, string>; // id is number in this case\n\n  public constructor() {\n    super(\"MessageDatabase\");\n    this.version(5).stores({\n      messages: \"id,user,pageId,videoId,[message+user],[message+videoId],[message+userId]\"\n    });\n    this.messages = this.table(\"messages\");\n  }\n}\n\nexport const messagesDatabase = new MessageDatabase();","import { Message, messagesDatabase } from \"../datastore/messagesDatabase\";\nimport { VideoComment } from \"./fb.definitions\";\n\nfunction videoCommentToDbMessage(message: VideoComment, videoId: string, pageId: string): Required<Message> {\n  return {\n    id: message.id.toString(),\n    message: message.message,\n    createdTime: message.created_time,\n    user: message.from.name,\n    pageId,\n    userPicture: message.from.picture.data.url,\n    userId: message.from.id,\n    broadcastTimestamp: message.live_broadcast_timestamp,\n    videoId,\n    likeCount: message.like_count\n  }\n}\n\nexport function dbMessageToVideoComment(message: Message): VideoComment {\n  return {\n    id: message.id ?? '',\n    message: message.message ?? 'Unknown Message',\n    created_time: message.createdTime ?? new Date().toISOString(),\n    like_count: message.likeCount ?? 0,\n    live_broadcast_timestamp: message.broadcastTimestamp ?? 0,\n    from: {\n      id: '',\n      name: message.user ?? 'Unknown Name',\n      picture: {\n        data: {\n          url: message.userPicture ?? 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxQHBhIRBxIOExAQEREVFxYVDRcVExIVGBIWFhUSFRUYHSggGh0lGxcVLTEhJSkrLi4uFx8zODMsNygtLisBCgoKDQ0NFQ4PEjEZFRkrKysrLTctLSsrKzctNysrLSsrNy0tKysrKy0rLSsrKysrKysrKystLSsrKysrKysrK//AABEIAOEA4QMBIgACEQEDEQH/xAAbAAEAAwEBAQEAAAAAAAAAAAAAAwQFBgIBB//EADUQAQABAgMDCQcEAwEAAAAAAAABAgMEBRESITETQVFhcYGhscEUIjI0kdHwQlKS4SRy8SP/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAMAwEAAhEDEQA/AP0wBpAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHqiiblWlETMg8vsRrOkcV2jLKqvjmmPGWjh8NTh6fcjf088mjMtZdXX8WlPbx+kJ4yr91U/xaQmqzpyqOaqf4o68rqj4KontjRqhowbuErtfHTOnTG+EDpVTE4Gm9GtO6rp6e2DUxij3dtTZr0uRv/N8PCgAAAAAAAAAAAAAAAAAA3MDh+Qsxr8U75+zHw9O3iKY6aodClABFAAAAAAQYzDxiLWnPHCWFMaTpPGHSMjNbWxfiqP1ecfkLBRAVAAAAAAAAAAAAAAAAFnL41xlPf5S3GHlvzlPf5S3EpABFAAAAAAFLNaNrC6/tmPt6rqtmM/4dWvV5wDDAaQAAAAAAAAAAAAAAABZy75ynv8pbjCwE6Yynt9JbqVQBAAAAAAAYmZVTOLmJmdI07t0Ntg46dcZV2+iwQAKgAAAAAAAAAAAAAAACfBRPtNMxE7qo5m8hwdGxhqYp6In6pkqgCAAAAAAAwMXExiatqJjWqebrb6pmdG1hJmeMaTH1WDFAVAAAAAAAAAAAAAAAAG5l9e3hKerd9Flm5Pc3VUz2+k+jSZqgAAAAAAAClm1ezhtP3THhv+y6yc2ubV6KY/THjKwUAFQAAAAAAAAAAAAAAABJh702LsVU/wDYbeFv+0WdqI047tWA08nubqqZ7fSfQo0gGVAAAAAAQYvEez2tdNd+nFh3bk3LkzVxmWhnFe+mmOufSPVmtRAAAAAAAAAAAAAAAAAABNhL3IYiJnhwnsQgOlidY3CllVya7GlX6Z0hdZUAAAABWzGuaMJOzz6R9QZWMu8tiZmOHCOyEANIAAAAAAAAAAAAAAAAAAAA2MpjTDT11T5RC6rZfTsYOnr1n6zqssqAAAAK2YxtYOru84WUeIp27FURz0zHgDngGkAAAAAAAAAAAAAAAAAAHqinbriKeMzoUUzXVpREzLVwGC5Gdq78XkC7TGzTERzQ+gyoAAAAADn8Vb5LEVR1+E8ETbx2E9op1p3VRw6+qWPctzaq0uRMS1EeAAAAAAAAAAAAAAB9iNqdKd8r2Hy2a997dHRz/wBAo007c6URMz1L+Hyyat9+dI6I4tGzZps06W4iPOe9ImmI7VmmzTpbiISAigAAAAAAADzctxcp0riJh6AZmIyznsT3T6Sz7lubdWlyJiXRvFy3F2nS5ETC6mOdGjiMs034ee6fSVCuiaKtK4mJ61HkAAAAAAH2N87gfFvC4Gq9vq92nxnshbwWA2I2r++ejmj+19NENjD02I/847+ee9MCKAAAAAAAAAAAAAAAAI71mm9TpciJ/OlIAyMVl8299r3o8Y+6i6VTxmBi/GtG6rwntXUYw9VUzRVMVRpMPKgAA0sqw2vv1933Z1MbVURHGZ0dFbo5O3EU8IjQo9AMqAAAAAAAAAAAAAAAAAAAAAAo5nh9u3t08aePXDIdLMaxvc9ft8leqp6J8OZYiMBRLhfmaP8AanzdACUgAigAAAAAAAAAAAAAAAAAAAAADEzL5yru8oBYKoCsv//Z'\n        }\n      }\n    }\n  }\n}\n\nexport async function batchInsertApiMessages(messages: VideoComment[], videoId: string, pageId: string) {\n  const dbMessages = messages.map((m) =>  videoCommentToDbMessage(m, videoId, pageId))\n  return await messagesDatabase.messages.bulkAdd(dbMessages)\n}\n\nexport async function insertOrUpdateMessage(message: VideoComment, videoId: string, pageId: string) {\n  const {id, ...allMessage} = videoCommentToDbMessage(message, videoId, pageId)\n  if(await messagesDatabase.messages.get(id) === undefined) {\n    return await messagesDatabase.messages.add({id, ...allMessage})\n  } else {\n    return await messagesDatabase.messages.update(id, allMessage)\n  }\n}\n","import { PageHeader, Button, Tag, Typography, Row } from 'antd';\nimport './VideoHeader.css'\nimport React, { FC } from 'react';\nimport { LiveVideo } from '../definitions';\nimport { useHistory } from 'react-router-dom';\nimport { DateTime } from 'luxon';\n\nconst { Paragraph } = Typography;\n\nconst Content = ({ children, extraContent }: any) => {\n  return (\n    <Row>\n      <div style={{ flex: 1 }}>{children}</div>\n      <div className=\"image\">{extraContent}</div>\n    </Row>\n  );\n};\n\nexport interface VideoHeaderProps {\n  liveVideo: LiveVideo\n}\n\nexport const VideoHeader: FC<VideoHeaderProps> = (props) => {\n  const { liveVideo } = props\n  const history = useHistory()\n  const videoTime = DateTime.fromISO(liveVideo.creation_time)\n  return (\n    <PageHeader\n      title={liveVideo.title}\n      onBack={() => history.goBack()}\n      className=\"site-page-header\"\n      subTitle={videoTime.toLocaleString(DateTime.DATETIME_MED)}\n      tags={<Tag color=\"blue\">{liveVideo.status}</Tag>}\n      extra={[\n        <Button key=\"1\" type=\"primary\" target=\"_blank\" href={`https://facebook.com/${liveVideo.permalink_url}`}>\n          Open\n      </Button>\n      ]}\n      avatar={{ src: liveVideo.video.icon }}\n    >\n      <Content\n        extraContent={\n          <img\n            src={liveVideo.video.picture}\n            alt={liveVideo.title}\n            width=\"100%\"\n          />\n        }\n      >\n        <Paragraph>\n          {liveVideo.description}\n        </Paragraph>\n      </Content>\n    </PageHeader>\n  )\n}","import { createContext } from \"react\";\nimport { PageToken } from \"./definitions\";\n\nexport const PageContext = createContext<PageToken | undefined>(undefined)","import { Tooltip } from \"antd\"\nimport React from \"react\"\nimport createPersistedState from \"use-persisted-state\"\nimport { memoize } from \"lodash\"\nimport { DateTime } from \"luxon\"\nimport { VideoComment } from \"../util/fb.definitions\"\n\nexport function formatComments(comments: VideoComment[]) {\n  return comments.map((c) => {\n    const date = DateTime.fromISO(c.created_time)\n    return {\n      actions: [],\n      author: c.from.name,\n      avatar: c.from.picture.data.url,\n      content: <p>{c.message}</p>,\n      datetime: (\n        <Tooltip title={date.toLocaleString(DateTime.TIME_24_WITH_SECONDS)}>\n          <span>{date.toRelative()}</span>\n        </Tooltip>\n      )\n    }\n  })\n}\nexport interface CustomVideoState {\n  messages: Record<string, CustomMessageState>\n}\nexport interface CustomMessageState {\n  hidden: boolean\n  down: boolean\n}\nexport const defaultVideoCustomState: CustomVideoState = {\n  messages: {}\n}\nexport const useVideoCustomState = memoize((videoId: string) => createPersistedState(`custom-video-settings-${videoId}`))\n\nexport const COMMENTS_PER_PAGE = 10","import { ArrowDownOutlined, ArrowUpOutlined, EyeInvisibleOutlined, EyeOutlined } from '@ant-design/icons'\nimport { List, Pagination, Comment, Tooltip } from 'antd'\nimport { DateTime } from 'luxon'\nimport React, { createElement, FC, useState } from 'react'\nimport { useParams } from 'react-router-dom'\nimport { VideoComment } from '../util/fb.definitions'\nimport { COMMENTS_PER_PAGE, CustomMessageState, CustomVideoState, defaultVideoCustomState, useVideoCustomState } from './util'\n\ninterface NotifiesListProps {\n  comments: VideoComment[]\n  perPage: number\n  text: string\n}\n\nfunction notifyActions(state: CustomMessageState, setMessageState: (messageState: Partial<CustomMessageState>) => void) {\n  return [\n    <Tooltip key=\"comment-basic-position\" title={state.down ? 'Move Up' : 'Move Down'}>\n      <span onClick={() => {setMessageState({down: !state.down})}}>\n        {createElement(state.down ? ArrowUpOutlined : ArrowDownOutlined)}\n      </span>\n    </Tooltip>,\n    <Tooltip key=\"comment-basic-hide\" title={state.hidden ? 'Show' : 'Hide'}>\n      <span onClick={() => {setMessageState({hidden: !state.hidden})}}>\n        {React.createElement(state.hidden ? EyeOutlined : EyeInvisibleOutlined)}\n      </span>\n    </Tooltip>\n  ]\n}\n\nexport const defaultMessageState:CustomMessageState = {hidden: false, down: false}\n\nfunction formatNotifies(comments: VideoComment[], videoState: CustomVideoState, setVideoState: React.Dispatch<React.SetStateAction<CustomVideoState>>) {\n  const setMessageState = (messageId: string) => (messageState: Partial<CustomMessageState>) => {\n    setVideoState((prevState) => {\n      const currentMessageState = prevState.messages[messageId] ?? defaultMessageState\n      const newMessageState = {...currentMessageState, ...messageState}\n      return {...prevState, messages: {...prevState.messages, [messageId]: newMessageState}}\n    })\n  }\n  return comments.map((c) => {\n    const date = DateTime.fromISO(c.created_time)\n    const messageState = videoState.messages[c.id] ?? defaultMessageState\n    return {\n      actions: notifyActions(messageState, setMessageState(c.id)),\n      author: c.from.name,\n      avatar: c.from.picture.data.url,\n      content: <p>{c.message}</p>,\n      datetime: (\n        <Tooltip title={date.toLocaleString(DateTime.TIME_WITH_SECONDS)}>\n          <span>{date.toRelative()}</span>\n        </Tooltip>\n      )\n    }\n  })\n}\n\nexport const NotifiesList: FC<NotifiesListProps> = (props) => {\n  const { comments, perPage, text } = props\n  const { id } = useParams<{ id: string }>()\n  const [currentPage, setPage] = useState(1)\n  const [videoState, setVideoState] = useVideoCustomState(id)(defaultVideoCustomState)\n  const offset = (currentPage - 1) * perPage\n  return (\n    <>\n      <List\n        className=\"comment-list\"\n        header={`${comments.length} ${text}`}\n        itemLayout=\"horizontal\"\n        dataSource={formatNotifies(comments.slice(offset, offset + perPage), videoState, setVideoState)}\n        renderItem={(item) => (\n          <li>\n            <Comment actions={item.actions} author={item.author} avatar={item.avatar} content={item.content} datetime={item.datetime} />\n          </li>\n        )}\n      />\n      <Pagination\n        current={currentPage}\n        onChange={(p) => setPage(p)}\n        total={comments.length}\n        showSizeChanger={false}\n        defaultPageSize={COMMENTS_PER_PAGE}\n        showTotal={(total, range) => `${range[0]}-${range[1]} of ${total} ${text}`}\n        defaultCurrent={1}\n      />\n    </>\n  )\n}\n\nexport function generateNotifiesForRound(videoId: string, notifies: VideoComment[], currentState: CustomVideoState) {\n  const withoutHiddenAndMoved = notifies.filter(n => !(currentState.messages[n.id] ?? defaultMessageState).hidden).filter(n => !(currentState.messages[n.id] ?? defaultMessageState).down)\n  const movedDown = notifies.filter(n => (currentState.messages[n.id] ?? defaultMessageState).down)\n  return [...withoutHiddenAndMoved, ...movedDown]\n}","import React, { FC, useContext, useEffect, useState } from 'react'\nimport { Card, Col, List, Row, Comment, Pagination, Layout, Spin, Slider } from 'antd'\nimport './App.css'\nimport { Breadcrumb } from 'antd'\nimport { LoadingOutlined, VideoCameraOutlined } from '@ant-design/icons'\nimport { LiveVideo, LiveVideos, PageToken } from './definitions'\nimport { reverse, sortBy, uniqBy } from 'lodash'\nimport { Redirect, Route, Switch, useHistory, useParams, useRouteMatch } from 'react-router-dom'\nimport { FbApiCall, FbParams, getAllResults, getPageToken, PersistedVideoData, usePersistedVideoData } from './util/fb'\nimport { batchInsertApiMessages, dbMessageToVideoComment } from './util/messages'\nimport { messagesDatabase } from './datastore/messagesDatabase'\nimport { VideoHeader } from './live_videos/VideoHeader'\nimport { PageContext } from './PageContext'\nimport { FacebookPaginatedResponse, VideoComment } from './util/fb.definitions'\nimport { COMMENTS_PER_PAGE, defaultVideoCustomState, formatComments, useVideoCustomState } from './live_videos/util'\nimport { generateNotifiesForRound, NotifiesList } from './live_videos/Notifies'\nimport { DateTime } from 'luxon'\nconst { Content } = Layout\n\nconst messagesParams = 'from{name,id,picture},message,id,created_time,like_count,live_broadcast_timestamp'\nconst defaultMessageParams: Omit<FbParams, 'access_token'> = {\n  limit: 100,\n  live_filter: 'no_filter',\n  order: 'reverse_chronological',\n  fields: messagesParams\n}\n\nconst VideoCard: FC<{ video: LiveVideo; span?: number; onClick?: ((selected: LiveVideo) => void) | undefined }> = (props) => {\n  const { video, span = 8, onClick = () => {} } = props\n  const icon = video.status === 'LIVE' ? <LoadingOutlined /> : <VideoCameraOutlined />\n  return (\n    <Col span={span}>\n      <Card\n        bordered={false}\n        hoverable={video.status === 'LIVE'}\n        onClick={() => onClick(video)}\n        cover={<img alt={video.title} src={video.video.picture} />}\n      >\n        <Card.Meta title={video.title} description={video.description} avatar={icon} />\n      </Card>\n    </Col>\n  )\n}\n\ninterface HasVideos {\n  videos: LiveVideo[]\n}\n\ninterface CurrentVideosProp extends HasVideos {}\nconst VIDEOS_PER_PAGE = 6\nconst CurrentVideos: FC<CurrentVideosProp> = (props) => {\n  const { videos } = props\n  const [currentPage, setPage] = useState(1)\n  const history = useHistory()\n  const offset = (currentPage - 1) * VIDEOS_PER_PAGE\n  const { pageId } = useParams<{ pageId: string }>()\n  return (\n    <Content style={{ margin: '0 16px' }}>\n      <Breadcrumb style={{ margin: '16px 0' }}>\n        <Breadcrumb.Item>LiaKumStreams</Breadcrumb.Item>\n        <Breadcrumb.Item>Live Videos</Breadcrumb.Item>\n      </Breadcrumb>\n      <div className=\"site-layout-background\" style={{ padding: 24, minHeight: 360 }}>\n        <Row gutter={16}>\n          {videos.slice(offset, offset + VIDEOS_PER_PAGE).map((v) => (\n            <VideoCard key={`video-${v.id}`} video={v} onClick={(v) => history.push(`/${pageId}/live_videos/${v.id}`)} />\n          ))}\n        </Row>\n        <Row gutter={16}>\n          <Pagination\n            current={currentPage}\n            onChange={(p) => setPage(p)}\n            total={videos.length}\n            showSizeChanger={false}\n            defaultPageSize={VIDEOS_PER_PAGE}\n            defaultCurrent={1}\n          />\n        </Row>\n      </div>\n    </Content>\n  )\n}\n\n\nasync function loadCachedMessages(videoId: string) {\n  const existingMessages = await messagesDatabase.messages.where({ videoId: videoId }).toArray()\n  return existingMessages.map(dbMessageToVideoComment)\n}\n\ninterface CommentsListProps {\n  comments: VideoComment[]\n  perPage: number\n  text: string\n}\nconst CommentsList: FC<CommentsListProps> = (props) => {\n  const { comments, perPage, text } = props\n  const [currentPage, setPage] = useState(1)\n  const offset = (currentPage - 1) * perPage\n  return (\n    <>\n      <List\n        className=\"comment-list\"\n        header={`${comments.length} ${text}`}\n        itemLayout=\"horizontal\"\n        dataSource={formatComments(comments.slice(offset, offset + perPage))}\n        renderItem={(item) => (\n          <li>\n            <Comment actions={item.actions} author={item.author} avatar={item.avatar} content={item.content} datetime={item.datetime} />\n          </li>\n        )}\n      />\n      <Pagination\n        current={currentPage}\n        onChange={(p) => setPage(p)}\n        total={comments.length}\n        showSizeChanger={false}\n        defaultPageSize={COMMENTS_PER_PAGE}\n        showTotal={(total, range) => `${range[0]}-${range[1]} of ${total} ${text}`}\n        defaultCurrent={1}\n      />\n    </>\n  )\n}\n\nfunction printRoundLine(name: string, round: number, roundSize: number) {\n  return `${round % roundSize === 0 ? '----Ronda----\\n' : ''}${name}\\n`\n}\n\nconst CommentsFeed: FC<{ video: LiveVideo }> = (props) => {\n  const { video } = props\n  const page = useContext(PageContext) as PageToken\n  const [loaded, setLoaded] = useState(false)\n  const [roundSize, setRoundSize] = useState(5)\n  const [comments, setComments] = useState<VideoComment[]>([])\n  const [videoState] = useVideoCustomState(video.id)(defaultVideoCustomState)\n  const { pageId } = useParams<{ pageId: string }>()\n  useEffect(() => {\n    let since = new Date().toISOString()\n    const effect = async () => {\n      if (video.status !== 'LIVE') {\n        setComments(sortBy(await loadCachedMessages(video.id), (m) => DateTime.fromISO(m.created_time).toMillis()).reverse())\n        setLoaded(true)\n        return\n      }\n      let comments = await FbApiCall<FacebookPaginatedResponse<VideoComment>>(`${video.id}/comments`, {\n        ...defaultMessageParams,\n        access_token: page.access_token\n      })\n      const allResults = await getAllResults(comments)\n      setComments(allResults)\n      if (allResults.length > 0) {\n        since = allResults[0].created_time\n      }\n      setLoaded(true)\n      return\n    }\n    const interval = setInterval(async () => {\n      const newComments = await FbApiCall<FacebookPaginatedResponse<VideoComment>>(`${video.id}/comments`, {\n        ...defaultMessageParams,\n        since,\n        access_token: page.access_token\n      })\n      if (newComments.data.length > 0) {\n        since = newComments.data[0].created_time\n      }\n      setComments((prev) => uniqBy([...newComments.data, ...prev], 'id'))\n    }, 5000)\n    effect()\n    return () => clearInterval(interval)\n  }, [loaded, video.id, pageId, video.status, page.access_token])\n\n  const notifies = reverse(\n    uniqBy(\n      comments.filter((c) => c.message.includes('!') && c.message.toLowerCase().includes('notify') && (c.from.name !== page.name ?? 'UNKNOWN PAGE')),\n      (c) => c.from.name\n    )\n  )\n\n  const filteredNotifies = generateNotifiesForRound(video.id, notifies, videoState)\n\n  return (\n    <>\n      <Col span={8}>\n        <Card title=\"Comments\">\n          <CommentsList text=\"replies\" comments={comments} perPage={COMMENTS_PER_PAGE} />\n        </Card>\n      </Col>\n      <Col span={8}>\n        <Card title=\"Notifies\">\n          <NotifiesList text=\"notifies\" comments={notifies} perPage={COMMENTS_PER_PAGE} />\n        </Card>\n      </Col>\n\n      <Col span={8}>\n        <Card title=\"Rounds by Notifies\">\n          Size: <Slider defaultValue={5} tooltipVisible value={roundSize} onChange={(v: number | any) => typeof v === 'number' && setRoundSize(v)} />\n          <pre>{filteredNotifies.map((n, i) => printRoundLine(n.from.name, i, roundSize))}</pre>\n        </Card>\n      </Col>\n    </>\n  )\n}\n\ninterface LiveVideoDashboardProps extends HasVideos {}\nconst LiveVideoDashboard: FC<LiveVideoDashboardProps> = (props) => {\n  const page = useContext(PageContext) as PageToken\n  const [persistedVideoData, setPersistedVideoData] = usePersistedVideoData<PersistedVideoData>({})\n  const [loading, setLoading] = useState(true)\n  const { id } = useParams<{ id: string }>()\n  const { videos } = props\n  const video = videos.find((v) => v.id === id)\n\n  useEffect(() => {\n    const effect = async () => {\n      if (video !== undefined && persistedVideoData[video.id] === true) {\n        setLoading(false)\n        return\n      }\n      if (video === undefined || video.status === 'LIVE') {\n        setLoading(false)\n        return\n      }\n\n      let comments = await FbApiCall<FacebookPaginatedResponse<VideoComment>>(`${video.id}/comments`, {\n        ...defaultMessageParams,\n        access_token: page.access_token\n      })\n      const allResults = await getAllResults(comments)\n      await batchInsertApiMessages(allResults, video.id, page.id)\n      setPersistedVideoData((prev) => ({ ...prev, [video.id]: true }))\n      setLoading(false)\n    }\n    effect()\n  }, [loading, setPersistedVideoData, persistedVideoData, video, page.access_token, page.id])\n\n  if (video === undefined) {\n    return <Redirect to=\"/live_videos\" />\n  }\n  return (\n    <Content style={{ margin: '0 16px' }}>\n      <Breadcrumb style={{ margin: '16px 0' }}>\n        <Breadcrumb.Item>LiaKumStreams</Breadcrumb.Item>\n        <Breadcrumb.Item>Live Videos</Breadcrumb.Item>\n        <Breadcrumb.Item>{video.title}</Breadcrumb.Item>\n      </Breadcrumb>\n\n      <div className=\"site-layout-background\" style={{ padding: 24, minHeight: 360 }}>\n        <Row gutter={16}>\n          <VideoHeader liveVideo={video} />\n        </Row>\n        <Row gutter={16}>{loading ? <Spin /> : <CommentsFeed video={video} />}</Row>\n      </div>\n    </Content>\n  )\n}\n\nexport const LiveVideosDashboard: FC = () => {\n  const { pageId } = useParams<{ pageId: string }>()\n  const [loadingVideos, setLoadingVideos] = useState(true)\n  const [videos, setVideos] = useState<LiveVideo[]>([])\n  const [pageData, setPageData] = useState<PageToken>()\n  useEffect(() => {\n    if (loadingVideos === true) {\n      const effect = async () => {\n        const tokenItem = await getPageToken(pageId)\n        FB.api(\n          `/${pageId}/live_videos`,\n          'get',\n          {\n            access_token: tokenItem?.access_token,\n            fields: 'status,creation_time,broadcast_start_time,description,embed_html,id,live_views,title,permalink_url,video{id,picture,icon}'\n          },\n          function (response: LiveVideos) {\n            setLoadingVideos(true)\n            setVideos(response.data)\n            setPageData(tokenItem)\n            setLoadingVideos(false)\n          }\n        )\n      }\n      effect()\n    }\n  }, [loadingVideos, pageId])\n  let match = useRouteMatch()\n  return (\n    <PageContext.Provider value={pageData}>\n      <Switch>\n        <Route path={`${match.path}/:id`}>{loadingVideos ? <Spin size=\"large\" /> : <LiveVideoDashboard videos={videos} />}</Route>\n        <Route path={match.path}>{loadingVideos ? <Spin size=\"large\" /> : <CurrentVideos videos={videos} />}</Route>\n      </Switch>\n    </PageContext.Provider>\n  )\n}\n","import { SettingOutlined } from '@ant-design/icons'\nimport { Breadcrumb, Button, Form, Input, Layout, Modal } from 'antd'\nimport React, { FC, useState } from 'react'\nimport { useChatBoxUrlState } from './util/streamlabs'\n\ninterface Values {\n  chatboxUrl: string\n}\n\ninterface CollectionCreateFormProps {\n  visible: boolean\n  onCreate: (values: Values) => void\n  onCancel: () => void\n}\n\nconst CollectionCreateForm: React.FC<CollectionCreateFormProps> = ({ visible, onCreate, onCancel }) => {\n  const [chatboxUrl] = useChatBoxUrlState<string>()\n  const [form] = Form.useForm<Values>()\n  return (\n    <Modal\n      visible={visible}\n      title=\"Set Chatbox URL\"\n      okText=\"Set\"\n      cancelText=\"Cancel\"\n      onCancel={onCancel}\n      onOk={() => {\n        form\n          .validateFields()\n          .then((values) => {\n            form.resetFields()\n            onCreate(values as Values)\n          })\n          .catch((info) => {\n            console.log('Validate Failed:', info)\n          })\n      }}\n    >\n      <Form form={form} layout=\"vertical\" name=\"form_in_modal\" initialValues={{ chatboxUrl: chatboxUrl ?? '' }}>\n        <Form.Item name=\"chatboxUrl\" label=\"Chatbox URL\" rules={[{ required: true, message: 'Please input the chatbox url!' }]}>\n          <Input addonAfter={<SettingOutlined />} placeholder=\"https://streamlabs.com/widgets/chat-box/v1/XXXXXXXXXXXXXXXXXXXX\" />\n        </Form.Item>\n      </Form>\n    </Modal>\n  )\n}\n\nconst UpdateChatboxUrl = () => {\n  const [visible, setVisible] = useState(false)\n  const [chatboxUrl, setChatboxUrl] = useChatBoxUrlState<string>()\n\n  const onCreate = (values: Values) => {\n    console.log('Received values of form: ', values)\n    setChatboxUrl(values.chatboxUrl)\n    setVisible(false)\n  }\n\n  return (\n    <>\n      <Button\n        type=\"primary\"\n        onClick={() => {\n          setVisible(true)\n        }}\n      >\n        Update Chatbox URL\n      </Button>\n      {chatboxUrl}\n      <CollectionCreateForm\n        visible={visible}\n        onCreate={onCreate}\n        onCancel={() => {\n          setVisible(false)\n        }}\n      />\n    </>\n  )\n}\n\nconst { Content } = Layout\n\nexport const PageSelector: FC = () => {\n  return (\n    <Content style={{ margin: '0 16px' }}>\n      <Breadcrumb style={{ margin: '16px 0' }}>\n        <Breadcrumb.Item>Home</Breadcrumb.Item>\n      </Breadcrumb>\n      <div className=\"site-layout-background\" style={{ padding: 24, minHeight: 360 }}>\n        <UpdateChatboxUrl />\n      </div>\n    </Content>\n  )\n}\n","import React, { FC, useEffect, useState } from 'react'\nimport './App.css'\nimport { Layout, Menu } from 'antd'\nimport { DashboardOutlined, FacebookOutlined, UnorderedListOutlined } from '@ant-design/icons'\nimport { BrowserRouter, Link, Route, Switch, useLocation } from 'react-router-dom'\nimport { LiveVideosDashboard } from './LiveVideoDashboard'\nimport { PageSelector } from './PageSelector'\nimport { PageToken, PageTokensResponse } from './definitions'\nimport { fetchStreamlabsConfig, isValidUrl } from './util/streamlabs'\nimport { getPagesTokens } from './util/fb'\n\nconst { Footer, Sider } = Layout\nconst { SubMenu } = Menu\n\nfunction getSelectedMenuItemKey(path: string) {\n  if (path.includes('/live_videos')) {\n    const [, pageId] = path.split('/')\n    return [`page-${pageId}-live_videos`]\n  }\n  return ['home']\n}\n\ninterface SidebarProps {\n  showPageSelector: boolean\n}\n\nconst Sidebar: FC<SidebarProps> = ({ showPageSelector }) => {\n  const [loading, setLoading] = useState(true)\n  const [pages, setPages] = useState<PageToken[]>([])\n  useEffect(() => {\n    const effect = async () => {\n      if (showPageSelector) {\n        const tokensResponse: PageTokensResponse = await getPagesTokens()\n        setPages(tokensResponse.data)\n        setLoading(false)\n      }\n    }\n    effect()\n  }, [loading, showPageSelector])\n  const [collapsed, setCollapsed] = useState(false)\n  const onCollapse = () => setCollapsed(!collapsed)\n  const match = useLocation()\n\n  console.log(match)\n\n  return (\n    <Sider collapsible collapsed={collapsed} onCollapse={onCollapse}>\n      <div className=\"logo\" />\n      <Menu theme=\"dark\" defaultSelectedKeys={['home']} mode=\"inline\" selectedKeys={getSelectedMenuItemKey(match.pathname)}>\n        <Menu.Item key=\"home\" icon={<DashboardOutlined />}>\n          <Link to=\"/\">Dashboard</Link>\n        </Menu.Item>\n        {pages.map((p) => (\n          <SubMenu key={`page-${p.id}`} icon={<FacebookOutlined />} title={p.name}>\n            <Menu.Item key={`page-${p.id}-live_videos`} icon={<UnorderedListOutlined />}>\n              <Link to={`/${p.id}/live_videos`}>Live Videos</Link>\n            </Menu.Item>\n          </SubMenu>\n        ))}\n      </Menu>\n    </Sider>\n  )\n}\n\nconst App: FC = () => {\n  const [loggedIn, setLoggedIn] = useState(false)\n  useEffect(() => {\n    const effect = async () => {\n      if (loggedIn === false) {\n        try {\n          if (isValidUrl()) {\n            await fetchStreamlabsConfig()\n            setLoggedIn(true)\n          }\n        } catch (error) {\n          console.error(error)\n        }\n      }\n    }\n    effect()\n  }, [loggedIn])\n  return (\n    <BrowserRouter basename=\"alegaming_site\">\n      <Layout style={{ minHeight: '100vh' }}>\n        <Sidebar showPageSelector={loggedIn} />\n        <Layout className=\"site-layout\">\n          {loggedIn ? (\n            <Switch>\n              <Route path=\"/:pageId/live_videos\">\n                <LiveVideosDashboard />\n              </Route>\n              <Route path=\"/\">\n                <PageSelector />\n              </Route>\n            </Switch>\n          ) : (\n            <PageSelector />\n          )}\n\n          <Footer style={{ textAlign: 'center' }}>Ale Ornelas ©2020</Footer>\n        </Layout>\n      </Layout>\n    </BrowserRouter>\n  )\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\ndeclare global {\n  interface Window {\n    fbAsyncInit: () => void;\n  }\n}\n\nwindow.fbAsyncInit = function () {\n  FB.init({\n    appId: '662939310992071',\n    autoLogAppEvents: true,\n    xfbml: true,\n    cookie: true,\n    version: 'v8.0'\n  });\n  ReactDOM.render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>,\n    document.getElementById('root')\n  );\n};\n\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}