{"version":3,"sources":["util/streamlabs.ts","util/fb.ts","datastore/messagesDatabase.ts","util/messages.ts","live_videos/VideoHeader.tsx","PageContext.ts","live_videos/util.tsx","live_videos/Notifies.tsx","hooks/useFacebookPage.ts","LiveVideoDashboard.tsx","PageSelector.tsx","widgets/RoundsWidget.tsx","widgets/Widgets.tsx","giveaway/AdvancedGiveaway.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["InvalidChatboxUrlError","Error","useChatBoxUrlState","createLocalStorageStateHook","STARTS","isValidUrl","storedUrl","JSON","parse","window","localStorage","getItem","console","log","error","startsWith","storedConfig","fetchStreamlabsConfig","a","fetch","headers","response","ok","json","config","getUserToken","streamlabsConfig","oauths","facebook_account","getUserId","usernames","getPagesTokens","pageAccessTokensResponse","getPageToken","id","tokens","data","find","t","usePersistedVideoData","useLastSelectedVideoInfo","useLastSelectedVideoComments","FbApiCall","path","params","method","Promise","resolve","reject","FB","api","errorResponse","message","getAllResults","results","allResults","push","undefined","paging","next","nextResponse","messagesDatabase","messages","version","stores","table","Dexie","videoCommentToDbMessage","videoId","pageId","toString","createdTime","created_time","user","from","name","userPicture","picture","url","userId","broadcastTimestamp","live_broadcast_timestamp","likeCount","like_count","dbMessageToVideoComment","Date","toISOString","batchInsertApiMessages","dbMessages","map","m","bulkAdd","Paragraph","Typography","Content","children","extraContent","style","flex","className","VideoHeader","props","liveVideo","history","useHistory","videoTime","DateTime","fromISO","creation_time","title","onBack","goBack","subTitle","toLocaleString","DATETIME_MED","tags","color","status","extra","key","type","target","href","permalink_url","avatar","src","video","icon","alt","width","description","PageContext","createContext","formatComments","comments","c","date","actions","author","content","datetime","TIME_24_WITH_SECONDS","toRelative","defaultVideoCustomState","roundSize","useVideoCustomState","memoize","notifyActions","state","setMessageState","priority","onClick","createElement","StarFilled","StarOutlined","down","ArrowUpOutlined","ArrowDownOutlined","hidden","React","EyeOutlined","EyeInvisibleOutlined","defaultMessageState","formatNotifies","videoState","setVideoState","messageId","messageState","prevState","currentMessageState","newMessageState","TIME_WITH_SECONDS","NotifiesList","perPage","text","useParams","useState","currentPage","setPage","offset","header","length","itemLayout","dataSource","slice","renderItem","item","current","onChange","p","total","showSizeChanger","defaultPageSize","showTotal","range","defaultCurrent","generateNotifiesForRound","notifies","currentState","withoutSpecialCases","filter","n","movedDown","includes","generateNotifies","pageName","uniqBy","orderBy","toMillis","toLowerCase","useFacebookPage","loadingVideos","setLoadingVideos","videos","setVideos","pageData","setPageData","useEffect","tokenItem","access_token","fields","effect","Layout","defaultMessageParams","limit","live_filter","order","VideoCard","span","LoadingOutlined","VideoCameraOutlined","bordered","hoverable","cover","Meta","CurrentVideos","margin","Item","padding","minHeight","gutter","v","loadCachedMessages","where","toArray","existingMessages","CommentsList","CommentsFeed","page","useContext","loaded","setLoaded","setComments","setLastSelectedVideoComments","composedSetComments","since","broadcast_start_time","sortBy","reverse","interval","setInterval","newComments","prev","clearInterval","filteredNotifies","defaultValue","tooltipVisible","value","setRoundSize","i","round","printRoundLine","LiveVideoDashboard","persistedVideoData","setPersistedVideoData","setLastSelectedVideo","loading","setLoading","to","LiveVideosDashboard","match","useRouteMatch","Provider","size","CollectionCreateForm","visible","onCreate","onCancel","chatboxUrl","Form","useForm","form","okText","cancelText","onOk","validateFields","then","values","resetFields","catch","info","layout","initialValues","label","rules","required","addonAfter","SettingOutlined","placeholder","UpdateChatboxUrl","setVisible","setChatboxUrl","PageSelector","RoundsWidget","videoInfo","notifiesForRound","separateRounds","chunk","Widgets","GiveawayData","postUrl","setPostUrl","prefix","FacebookOutlined","enterButton","SaveOutlined","onSearch","AdvancedGiveaway","Footer","Sider","SubMenu","Menu","getSelectedMenuItemKey","split","Sidebar","showPageSelector","pages","setPages","tokensResponse","collapsed","setCollapsed","useLocation","collapsible","onCollapse","theme","defaultSelectedKeys","mode","selectedKeys","pathname","DashboardOutlined","UnorderedListOutlined","GifOutlined","NormalPage","loggedIn","setLoggedIn","textAlign","App","basename","Boolean","location","hostname","fbAsyncInit","init","appId","autoLogAppEvents","xfbml","cookie","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.3182d4e9.chunk.js","sourcesContent":["import { last } from 'lodash'\nimport { createLocalStorageStateHook } from 'use-local-storage-state'\nimport { StreamLabsConfig } from './streamlabs.definitions'\n\nexport class InvalidChatboxUrlError extends Error {}\n\nexport const useChatBoxUrlState = createLocalStorageStateHook<string>('chatboxUrl')\n\nconst STARTS = 'https://streamlabs.com/widgets/chat-box/v1/'\nexport function isValidUrl() {\n  const storedUrl = JSON.parse(window.localStorage.getItem('chatboxUrl') ?? '\"\"')\n  console.log('storedUrl', storedUrl)\n  if (storedUrl === null) {\n    console.error('storedUrl is null')\n    return false\n  }\n  if (!storedUrl.startsWith(STARTS)) {\n    console.error(`storedUrl <${storedUrl}> doesn't start with <${STARTS}>.`)\n    return false\n  }\n  return true\n}\n\nexport function getStreamlabsToken() {\n  return new Promise<string>((resolve, reject) => {\n    if (isValidUrl()) {\n      const url = JSON.parse(window.localStorage.getItem('chatboxUrl') ?? '\"\"') as string\n      resolve(last(url.split('/')))\n    } else {\n      reject(new InvalidChatboxUrlError('localStorage.chatboxUrl is empty or invalid.'))\n    }\n  })\n}\n\nlet storedConfig: StreamLabsConfig | null = null\nexport async function fetchStreamlabsConfig() {\n  if (storedConfig !== null) {\n    return storedConfig\n  }\n  const storedUrl = JSON.parse(window.localStorage.getItem('chatboxUrl') ?? '\"\"')\n  const response = await fetch(`https://murmuring-plateau-21894.herokuapp.com/?url=${storedUrl}`, {\n    headers: {\n      'x-token': 'eQ1z8bmURCR2Odtg4NR8M'\n    }\n  })\n  if (!response.ok) {\n    throw new InvalidChatboxUrlError('localStorage.chatboxUrl is empty or invalid.')\n  }\n  const config = (await response.json()) as StreamLabsConfig\n  storedConfig = config\n  return config\n}\n","import { createLocalStorageStateHook } from 'use-local-storage-state'\nimport { PageToken, PageTokensResponse } from \"../definitions\"\nimport { FacebookPaginatedResponse, VideoComment } from \"./fb.definitions\"\nimport { fetchStreamlabsConfig } from \"./streamlabs\"\n\nexport class InvalidFacebookUserTokenError extends Error {}\nexport class InvalidFacebookPageTokenError extends Error {}\n\n\nexport interface FacebookMe {\n  name: string\n}\n\nexport interface HasError {\n  error: any\n}\n\nexport async function getUserToken(): Promise<string> {\n  const streamlabsConfig = await fetchStreamlabsConfig()\n  return streamlabsConfig.oauths.facebook_account\n}\n\nexport async function getUserId(): Promise<string> {\n  const streamlabsConfig = await fetchStreamlabsConfig()\n  return streamlabsConfig.usernames.facebook_account\n}\n\nexport async function getPagesTokens(): Promise<PageTokensResponse> {\n  const pageAccessTokensResponse = await fetch(`https://graph.facebook.com/${await getUserId()}/accounts?access_token=${await getUserToken()}`)\n  return pageAccessTokensResponse.json() \n}\n\nexport async function getPageToken(id: string) {\n  const tokens = await getPagesTokens()\n  return tokens.data.find(t => t.id === id)\n}\n\nexport interface SelectedVideoInfo {\n  id: string,\n  page: PageToken\n}\n\nexport type PersistedVideoData = Record<string, boolean>\nexport const usePersistedVideoData = createLocalStorageStateHook<PersistedVideoData>('persistedVideoData', {})\nexport const useLastSelectedVideoInfo = createLocalStorageStateHook<SelectedVideoInfo>('lastSelectedVideoInfo')\nexport const useLastSelectedVideoComments = createLocalStorageStateHook<VideoComment[]>('lastSelectedVideoComments', [])\n\ninterface FbError {\n  error: string | unknown\n}\n\nexport interface FbParams {\n  access_token: string;\n  fields: string;\n  limit?: number\n  live_filter?: 'no_filter' | 'filter_low_quality'\n  order?: 'chronological' | 'reverse_chronological'\n  since?: string\n}\n\nexport function FbApiCall<T = unknown>(path: string, params: FbParams, method: \"get\" | \"post\" | \"delete\" = 'get'): Promise<T> {\n  return new Promise((resolve, reject) => {\n    FB.api(\n      path,\n      method,\n      params,\n      function (response: T | FbError | undefined) {\n        if(response == null) {\n          reject(new Error('Empty Response'))\n        }\n        if((response as FbError).error != null) {\n          const errorResponse = response as FbError\n          const message = typeof errorResponse.error === 'string' ? errorResponse.error : 'FB Api Error'\n          console.error(response)\n          reject(new Error(message))\n        }\n        resolve(response as T)\n      }\n    );\n  })\n}\n\nexport async function getAllResults<T extends FacebookPaginatedResponse>(results: T) {\n  let allResults: T['data'] = []\n\n  allResults.push(...results.data)\n  while (results.paging?.next !== undefined) {\n    const nextResponse = await fetch(results.paging.next)\n    results = await nextResponse.json()\n    allResults.push(...results.data)\n  }\n  return allResults\n}","import Dexie from 'dexie';\n\nexport interface Message {\n  id?: string;\n  message?: string;\n  createdTime?: string;\n  broadcastTimestamp?: number;\n  user?: string\n  userId?: string\n  userPicture?: string\n  pageId?: string\n  videoId?: string\n  likeCount?: number\n}\n\n//\n// Declare Database\n//\nclass MessageDatabase extends Dexie {\n  public messages: Dexie.Table<Message, string>; // id is number in this case\n\n  public constructor() {\n    super(\"MessageDatabase\");\n    this.version(5).stores({\n      messages: \"id,user,pageId,videoId,[message+user],[message+videoId],[message+userId]\"\n    });\n    this.messages = this.table(\"messages\");\n  }\n}\n\nexport const messagesDatabase = new MessageDatabase();","import { Message, messagesDatabase } from \"../datastore/messagesDatabase\";\nimport { VideoComment } from \"./fb.definitions\";\n\nfunction videoCommentToDbMessage(message: VideoComment, videoId: string, pageId: string): Required<Message> {\n  return {\n    id: message.id.toString(),\n    message: message.message,\n    createdTime: message.created_time,\n    user: message.from.name,\n    pageId,\n    userPicture: message.from.picture.data.url,\n    userId: message.from.id,\n    broadcastTimestamp: message.live_broadcast_timestamp,\n    videoId,\n    likeCount: message.like_count\n  }\n}\n\nexport function dbMessageToVideoComment(message: Message): VideoComment {\n  return {\n    id: message.id ?? '',\n    message: message.message ?? 'Unknown Message',\n    created_time: message.createdTime ?? new Date().toISOString(),\n    like_count: message.likeCount ?? 0,\n    live_broadcast_timestamp: message.broadcastTimestamp ?? 0,\n    from: {\n      id: message.userId ?? '',\n      name: message.user ?? 'Unknown Name',\n      picture: {\n        data: {\n          url: message.userPicture ?? 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxQHBhIRBxIOExAQEREVFxYVDRcVExIVGBIWFhUSFRUYHSggGh0lGxcVLTEhJSkrLi4uFx8zODMsNygtLisBCgoKDQ0NFQ4PEjEZFRkrKysrLTctLSsrKzctNysrLSsrNy0tKysrKy0rLSsrKysrKysrKystLSsrKysrKysrK//AABEIAOEA4QMBIgACEQEDEQH/xAAbAAEAAwEBAQEAAAAAAAAAAAAAAwQFBgIBB//EADUQAQABAgMDCQcEAwEAAAAAAAABAgMEBRESITETQVFhcYGhscEUIjI0kdHwQlKS4SRy8SP/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAMAwEAAhEDEQA/AP0wBpAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHqiiblWlETMg8vsRrOkcV2jLKqvjmmPGWjh8NTh6fcjf088mjMtZdXX8WlPbx+kJ4yr91U/xaQmqzpyqOaqf4o68rqj4KontjRqhowbuErtfHTOnTG+EDpVTE4Gm9GtO6rp6e2DUxij3dtTZr0uRv/N8PCgAAAAAAAAAAAAAAAAAA3MDh+Qsxr8U75+zHw9O3iKY6aodClABFAAAAAAQYzDxiLWnPHCWFMaTpPGHSMjNbWxfiqP1ecfkLBRAVAAAAAAAAAAAAAAAAFnL41xlPf5S3GHlvzlPf5S3EpABFAAAAAAFLNaNrC6/tmPt6rqtmM/4dWvV5wDDAaQAAAAAAAAAAAAAAABZy75ynv8pbjCwE6Yynt9JbqVQBAAAAAAAYmZVTOLmJmdI07t0Ntg46dcZV2+iwQAKgAAAAAAAAAAAAAAACfBRPtNMxE7qo5m8hwdGxhqYp6In6pkqgCAAAAAAAwMXExiatqJjWqebrb6pmdG1hJmeMaTH1WDFAVAAAAAAAAAAAAAAAAG5l9e3hKerd9Flm5Pc3VUz2+k+jSZqgAAAAAAAClm1ezhtP3THhv+y6yc2ubV6KY/THjKwUAFQAAAAAAAAAAAAAAABJh702LsVU/wDYbeFv+0WdqI047tWA08nubqqZ7fSfQo0gGVAAAAAAQYvEez2tdNd+nFh3bk3LkzVxmWhnFe+mmOufSPVmtRAAAAAAAAAAAAAAAAAABNhL3IYiJnhwnsQgOlidY3CllVya7GlX6Z0hdZUAAAABWzGuaMJOzz6R9QZWMu8tiZmOHCOyEANIAAAAAAAAAAAAAAAAAAAA2MpjTDT11T5RC6rZfTsYOnr1n6zqssqAAAAK2YxtYOru84WUeIp27FURz0zHgDngGkAAAAAAAAAAAAAAAAAAHqinbriKeMzoUUzXVpREzLVwGC5Gdq78XkC7TGzTERzQ+gyoAAAAADn8Vb5LEVR1+E8ETbx2E9op1p3VRw6+qWPctzaq0uRMS1EeAAAAAAAAAAAAAAB9iNqdKd8r2Hy2a997dHRz/wBAo007c6URMz1L+Hyyat9+dI6I4tGzZps06W4iPOe9ImmI7VmmzTpbiISAigAAAAAAADzctxcp0riJh6AZmIyznsT3T6Sz7lubdWlyJiXRvFy3F2nS5ETC6mOdGjiMs034ee6fSVCuiaKtK4mJ61HkAAAAAAH2N87gfFvC4Gq9vq92nxnshbwWA2I2r++ejmj+19NENjD02I/847+ee9MCKAAAAAAAAAAAAAAAAI71mm9TpciJ/OlIAyMVl8299r3o8Y+6i6VTxmBi/GtG6rwntXUYw9VUzRVMVRpMPKgAA0sqw2vv1933Z1MbVURHGZ0dFbo5O3EU8IjQo9AMqAAAAAAAAAAAAAAAAAAAAAAo5nh9u3t08aePXDIdLMaxvc9ft8leqp6J8OZYiMBRLhfmaP8AanzdACUgAigAAAAAAAAAAAAAAAAAAAAADEzL5yru8oBYKoCsv//Z'\n        }\n      }\n    }\n  }\n}\n\nexport async function batchInsertApiMessages(messages: VideoComment[], videoId: string, pageId: string) {\n  const dbMessages = messages.map((m) =>  videoCommentToDbMessage(m, videoId, pageId))\n  return await messagesDatabase.messages.bulkAdd(dbMessages)\n}\n\nexport async function insertOrUpdateMessage(message: VideoComment, videoId: string, pageId: string) {\n  const {id, ...allMessage} = videoCommentToDbMessage(message, videoId, pageId)\n  if(await messagesDatabase.messages.get(id) === undefined) {\n    return await messagesDatabase.messages.add({id, ...allMessage})\n  } else {\n    return await messagesDatabase.messages.update(id, allMessage)\n  }\n}\n","import { PageHeader, Button, Tag, Typography, Row } from 'antd';\nimport './VideoHeader.css'\nimport React, { FC } from 'react';\nimport { LiveVideo } from '../definitions';\nimport { useHistory } from 'react-router-dom';\nimport { DateTime } from 'luxon';\n\nconst { Paragraph } = Typography;\n\nconst Content = ({ children, extraContent }: any) => {\n  return (\n    <Row>\n      <div style={{ flex: 1 }}>{children}</div>\n      <div className=\"image\">{extraContent}</div>\n    </Row>\n  );\n};\n\nexport interface VideoHeaderProps {\n  liveVideo: LiveVideo\n}\n\nexport const VideoHeader: FC<VideoHeaderProps> = (props) => {\n  const { liveVideo } = props\n  const history = useHistory()\n  const videoTime = DateTime.fromISO(liveVideo.creation_time)\n  return (\n    <PageHeader\n      title={liveVideo.title}\n      onBack={() => history.goBack()}\n      className=\"site-page-header\"\n      subTitle={videoTime.toLocaleString(DateTime.DATETIME_MED)}\n      tags={<Tag color=\"blue\">{liveVideo.status}</Tag>}\n      extra={[\n        <Button key=\"1\" type=\"primary\" target=\"_blank\" href={`https://facebook.com/${liveVideo.permalink_url}`}>\n          Open\n      </Button>\n      ]}\n      avatar={{ src: liveVideo.video.icon }}\n    >\n      <Content\n        extraContent={\n          <img\n            src={liveVideo.video.picture}\n            alt={liveVideo.title}\n            width=\"100%\"\n          />\n        }\n      >\n        <Paragraph>\n          {liveVideo.description}\n        </Paragraph>\n      </Content>\n    </PageHeader>\n  )\n}","import { createContext } from \"react\";\nimport { PageToken } from \"./definitions\";\n\nexport const PageContext = createContext<PageToken | undefined>(undefined)","import { Tooltip } from \"antd\"\nimport React from \"react\"\nimport { createLocalStorageStateHook } from 'use-local-storage-state'\nimport { memoize } from \"lodash\"\nimport { DateTime } from \"luxon\"\nimport { VideoComment } from \"../util/fb.definitions\"\n\nexport function formatComments(comments: VideoComment[]) {\n  return comments.map((c) => {\n    const date = DateTime.fromISO(c.created_time)\n    return {\n      actions: [],\n      author: c.from.name,\n      avatar: c.from.picture.data.url,\n      content: <p>{c.message}</p>,\n      datetime: (\n        <Tooltip title={date.toLocaleString(DateTime.TIME_24_WITH_SECONDS)}>\n          <span>{date.toRelative()}</span>\n        </Tooltip>\n      )\n    }\n  })\n}\nexport interface CustomVideoState {\n  messages: Record<string, CustomMessageState>\n  roundSize: number\n}\nexport interface CustomMessageState {\n  priority: boolean\n  hidden: boolean\n  down: boolean\n}\nexport const defaultVideoCustomState: CustomVideoState = {\n  roundSize: 5,\n  messages: {}\n}\nexport const useVideoCustomState = memoize((videoId: string) => createLocalStorageStateHook<CustomVideoState>(`custom-video-settings-${videoId}`, defaultVideoCustomState))\n\nexport const COMMENTS_PER_PAGE = 10","import { ArrowDownOutlined, ArrowUpOutlined, EyeInvisibleOutlined, EyeOutlined, StarFilled, StarOutlined } from '@ant-design/icons'\nimport { List, Pagination, Comment, Tooltip } from 'antd'\nimport { uniqBy, orderBy } from 'lodash'\nimport { DateTime } from 'luxon'\nimport React, { createElement, FC, useState } from 'react'\nimport { useParams } from 'react-router-dom'\nimport { VideoComment } from '../util/fb.definitions'\nimport { COMMENTS_PER_PAGE, CustomMessageState, CustomVideoState, useVideoCustomState } from './util'\n\ninterface NotifiesListProps {\n  comments: VideoComment[]\n  perPage: number\n  text: string\n}\n\nfunction notifyActions(state: CustomMessageState, setMessageState: (messageState: Partial<CustomMessageState>) => void) {\n  return [\n    <Tooltip key=\"comment-priority\" title={state.priority ? 'Normal' : 'Priority'}>\n      <span\n        onClick={() => {\n          setMessageState({ priority: !state.priority })\n        }}\n      >\n        {createElement(state.priority ? StarFilled : StarOutlined)}\n      </span>\n    </Tooltip>,\n    <Tooltip key=\"comment-basic-position\" title={state.down ? 'Move Up' : 'Move Down'}>\n      <span\n        onClick={() => {\n          setMessageState({ down: !state.down })\n        }}\n      >\n        {createElement(state.down ? ArrowUpOutlined : ArrowDownOutlined)}\n      </span>\n    </Tooltip>,\n    <Tooltip key=\"comment-basic-hide\" title={state.hidden ? 'Show' : 'Hide'}>\n      <span\n        onClick={() => {\n          setMessageState({ hidden: !state.hidden })\n        }}\n      >\n        {React.createElement(state.hidden ? EyeOutlined : EyeInvisibleOutlined)}\n      </span>\n    </Tooltip>\n  ]\n}\n\nexport const defaultMessageState: CustomMessageState = { hidden: false, down: false, priority: false }\n\nfunction formatNotifies(\n  comments: VideoComment[],\n  videoState: CustomVideoState,\n  setVideoState: React.Dispatch<React.SetStateAction<CustomVideoState>>\n) {\n  const setMessageState = (messageId: string) => (messageState: Partial<CustomMessageState>) => {\n    setVideoState((prevState) => {\n      const currentMessageState = prevState.messages[messageId] ?? defaultMessageState\n      const newMessageState = { ...currentMessageState, ...messageState }\n      return { ...prevState, messages: { ...prevState.messages, [messageId]: newMessageState } }\n    })\n  }\n  return comments.map((c) => {\n    const date = DateTime.fromISO(c.created_time)\n    const messageState = videoState.messages[c.id] ?? defaultMessageState\n    return {\n      actions: notifyActions(messageState, setMessageState(c.id)),\n      author: c.from.name,\n      avatar: c.from.picture.data.url,\n      content: <p>{c.message}</p>,\n      datetime: (\n        <Tooltip title={date.toLocaleString(DateTime.TIME_WITH_SECONDS)}>\n          <span>{date.toRelative()}</span>\n        </Tooltip>\n      )\n    }\n  })\n}\n\nexport const NotifiesList: FC<NotifiesListProps> = (props) => {\n  const { comments, perPage, text } = props\n  const { id } = useParams<{ id: string }>()\n  const [currentPage, setPage] = useState(1)\n  const [videoState, setVideoState] = useVideoCustomState(id)()\n  const offset = (currentPage - 1) * perPage\n  return (\n    <>\n      <List\n        className=\"comment-list\"\n        header={`${comments.length} ${text}`}\n        itemLayout=\"horizontal\"\n        dataSource={formatNotifies(comments.slice(offset, offset + perPage), videoState, setVideoState)}\n        renderItem={(item) => (\n          <li>\n            <Comment actions={item.actions} author={item.author} avatar={item.avatar} content={item.content} datetime={item.datetime} />\n          </li>\n        )}\n      />\n      <Pagination\n        current={currentPage}\n        onChange={(p) => setPage(p)}\n        total={comments.length}\n        showSizeChanger={false}\n        defaultPageSize={COMMENTS_PER_PAGE}\n        showTotal={(total, range) => `${range[0]}-${range[1]} of ${total} ${text}`}\n        defaultCurrent={1}\n      />\n    </>\n  )\n}\n\nexport function generateNotifiesForRound(notifies: VideoComment[], currentState: CustomVideoState) {\n  const withoutSpecialCases = notifies\n    .filter((n) => !(currentState.messages[n.id] ?? defaultMessageState).priority)\n    .filter((n) => !(currentState.messages[n.id] ?? defaultMessageState).hidden)\n    .filter((n) => !(currentState.messages[n.id] ?? defaultMessageState).down)\n  const priority = notifies.filter((n) => (currentState.messages[n.id] ?? defaultMessageState).priority)\n  const movedDown = notifies.filter((n) => (currentState.messages[n.id] ?? defaultMessageState).down && !priority.includes(n))\n  return [...priority, ...withoutSpecialCases, ...movedDown]\n}\n\nexport function generateNotifies(comments: VideoComment[], pageName: string) {\n  return uniqBy(\n      orderBy(comments, (c) => DateTime.fromISO(c.created_time).toMillis(), 'asc').filter(\n        (c) => c.message.includes('!') && c.message.toLowerCase().includes('notify') && (c.from.name !== pageName ?? 'UNKNOWN PAGE')\n      ),\n      (c) => c.from.id\n    )\n  \n}\n","import { useState, useEffect } from \"react\"\nimport { LiveVideo, PageToken, LiveVideos } from \"../definitions\"\nimport { getPageToken } from \"../util/fb\"\n\nexport function useFacebookPage(pageId: string): [boolean, PageToken | undefined, LiveVideo[]] {\n  const [loadingVideos, setLoadingVideos] = useState(true)\n  const [videos, setVideos] = useState<LiveVideo[]>([])\n  const [pageData, setPageData] = useState<PageToken>()\n\n  useEffect(() => {\n    if (loadingVideos === true) {\n      const effect = async () => {\n        const tokenItem = await getPageToken(pageId)\n        FB.api(\n          `/${pageId}/live_videos`,\n          'get',\n          {\n            access_token: tokenItem?.access_token,\n            fields: 'status,creation_time,broadcast_start_time,description,embed_html,id,live_views,title,permalink_url,video{id,picture,icon}'\n          },\n          function (response: LiveVideos) {\n            setLoadingVideos(true)\n            setVideos(response.data)\n            setPageData(tokenItem)\n            setLoadingVideos(false)\n          }\n        )\n      }\n      effect()\n    }\n  }, [loadingVideos, pageId])\n\n  return [loadingVideos, pageData, videos]\n}\n","import React, { FC, useContext, useEffect, useState } from 'react'\nimport { Card, Col, List, Row, Comment, Pagination, Layout, Spin, Slider } from 'antd'\nimport './App.css'\nimport { Breadcrumb } from 'antd'\nimport { LoadingOutlined, VideoCameraOutlined } from '@ant-design/icons'\nimport { LiveVideo, PageToken } from './definitions'\nimport { sortBy, uniqBy } from 'lodash'\nimport { Redirect, Route, Switch, useHistory, useParams, useRouteMatch } from 'react-router-dom'\nimport {\n  FbApiCall,\n  FbParams,\n  getAllResults,\n  useLastSelectedVideoInfo,\n  useLastSelectedVideoComments,\n  usePersistedVideoData\n} from './util/fb'\nimport { batchInsertApiMessages, dbMessageToVideoComment } from './util/messages'\nimport { messagesDatabase } from './datastore/messagesDatabase'\nimport { VideoHeader } from './live_videos/VideoHeader'\nimport { PageContext } from './PageContext'\nimport { FacebookPaginatedResponse, VideoComment } from './util/fb.definitions'\nimport { COMMENTS_PER_PAGE, formatComments, useVideoCustomState } from './live_videos/util'\nimport { generateNotifies, generateNotifiesForRound, NotifiesList } from './live_videos/Notifies'\nimport { DateTime } from 'luxon'\nimport { useFacebookPage } from './hooks/useFacebookPage'\nconst { Content } = Layout\n\nconst messagesParams = 'from{name,id,picture},message,id,created_time,like_count,live_broadcast_timestamp'\nconst defaultMessageParams: Omit<FbParams, 'access_token'> = {\n  limit: 100,\n  live_filter: 'no_filter',\n  order: 'reverse_chronological',\n  fields: messagesParams\n}\n\nconst VideoCard: FC<{ video: LiveVideo; span?: number; onClick?: ((selected: LiveVideo) => void) | undefined }> = (props) => {\n  const { video, span = 8, onClick = () => {} } = props\n  const icon = video.status === 'LIVE' ? <LoadingOutlined /> : <VideoCameraOutlined />\n  return (\n    <Col span={span}>\n      <Card\n        bordered={false}\n        hoverable={video.status === 'LIVE'}\n        onClick={() => onClick(video)}\n        cover={<img alt={video.title} src={video.video.picture} />}\n      >\n        <Card.Meta title={video.title} description={video.description} avatar={icon} />\n      </Card>\n    </Col>\n  )\n}\n\ninterface HasVideos {\n  videos: LiveVideo[]\n}\n\ninterface CurrentVideosProp extends HasVideos {}\nconst VIDEOS_PER_PAGE = 6\nconst CurrentVideos: FC<CurrentVideosProp> = (props) => {\n  const { videos } = props\n  const [currentPage, setPage] = useState(1)\n  const history = useHistory()\n  const offset = (currentPage - 1) * VIDEOS_PER_PAGE\n  const { pageId } = useParams<{ pageId: string }>()\n  return (\n    <Content style={{ margin: '0 16px' }}>\n      <Breadcrumb style={{ margin: '16px 0' }}>\n        <Breadcrumb.Item>LiaKumStreams</Breadcrumb.Item>\n        <Breadcrumb.Item>Live Videos</Breadcrumb.Item>\n      </Breadcrumb>\n      <div className=\"site-layout-background\" style={{ padding: 24, minHeight: 360 }}>\n        <Row gutter={16}>\n          {videos.slice(offset, offset + VIDEOS_PER_PAGE).map((v) => (\n            <VideoCard key={`video-${v.id}`} video={v} onClick={(v) => history.push(`/${pageId}/live_videos/${v.id}`)} />\n          ))}\n        </Row>\n        <Row gutter={16}>\n          <Pagination\n            current={currentPage}\n            onChange={(p) => setPage(p)}\n            total={videos.length}\n            showSizeChanger={false}\n            defaultPageSize={VIDEOS_PER_PAGE}\n            defaultCurrent={1}\n          />\n        </Row>\n      </div>\n    </Content>\n  )\n}\n\nasync function loadCachedMessages(videoId: string) {\n  const existingMessages = await messagesDatabase.messages.where({ videoId: videoId }).toArray()\n  return existingMessages.map(dbMessageToVideoComment)\n}\n\ninterface CommentsListProps {\n  comments: VideoComment[]\n  perPage: number\n  text: string\n}\nconst CommentsList: FC<CommentsListProps> = (props) => {\n  const { comments, perPage, text } = props\n  const [currentPage, setPage] = useState(1)\n  const offset = (currentPage - 1) * perPage\n  return (\n    <>\n      <List\n        className=\"comment-list\"\n        header={`${comments.length} ${text}`}\n        itemLayout=\"horizontal\"\n        dataSource={formatComments(comments.slice(offset, offset + perPage))}\n        renderItem={(item) => (\n          <li>\n            <Comment actions={item.actions} author={item.author} avatar={item.avatar} content={item.content} datetime={item.datetime} />\n          </li>\n        )}\n      />\n      <Pagination\n        current={currentPage}\n        onChange={(p) => setPage(p)}\n        total={comments.length}\n        showSizeChanger={false}\n        defaultPageSize={COMMENTS_PER_PAGE}\n        showTotal={(total, range) => `${range[0]}-${range[1]} of ${total} ${text}`}\n        defaultCurrent={1}\n      />\n    </>\n  )\n}\n\nfunction printRoundLine(name: string, round: number, roundSize: number) {\n  return `${round % roundSize === 0 ? '----Ronda----\\n' : ''}${name}\\n`\n}\n\nconst CommentsFeed: FC<{ video: LiveVideo }> = (props) => {\n  const { video } = props\n  const page = useContext(PageContext) as PageToken\n  const [loaded, setLoaded] = useState(false)\n  const [comments, setComments] = useState<VideoComment[]>([])\n  const [, setLastSelectedVideoComments] = useLastSelectedVideoComments()\n  const [videoState, setVideoState] = useVideoCustomState(video.id)()\n  const { pageId } = useParams<{ pageId: string }>()\n  const { roundSize } = videoState\n  const setRoundSize = (roundSize: number) => setVideoState((prev) => ({ ...prev, roundSize }))\n  useEffect(() => {\n    const composedSetComments: React.Dispatch<React.SetStateAction<VideoComment[]>> = (params) => {\n      setLastSelectedVideoComments(params)\n      return setComments(params)\n    }\n    let since = video.broadcast_start_time\n    const effect = async () => {\n      if (video.status !== 'LIVE') {\n        composedSetComments(sortBy(await loadCachedMessages(video.id), (m) => DateTime.fromISO(m.created_time).toMillis()).reverse())\n        setLoaded(true)\n        return\n      }\n      let comments = await FbApiCall<FacebookPaginatedResponse<VideoComment>>(`${video.id}/comments`, {\n        ...defaultMessageParams,\n        access_token: page.access_token\n      })\n      const allResults = await getAllResults(comments)\n      composedSetComments(allResults)\n      if (allResults.length > 0) {\n        since = allResults[0].created_time\n      }\n      setLoaded(true)\n      return\n    }\n    const interval = setInterval(async () => {\n      const newComments = await FbApiCall<FacebookPaginatedResponse<VideoComment>>(`${video.id}/comments`, {\n        ...defaultMessageParams,\n        since,\n        access_token: page.access_token\n      })\n      if (newComments.data.length > 0) {\n        since = newComments.data[0].created_time\n      }\n      composedSetComments((prev) => uniqBy([...newComments.data, ...prev], 'id'))\n    }, 5000)\n    effect()\n    return () => clearInterval(interval)\n  }, [loaded, video.id, pageId, video.status, page.access_token, video.broadcast_start_time, setLastSelectedVideoComments])\n\n  const notifies = generateNotifies(comments, page.name)\n\n  const filteredNotifies = generateNotifiesForRound(notifies, videoState)\n\n  return (\n    <>\n      <Col span={8}>\n        <Card title=\"Comments\">\n          <CommentsList text=\"replies\" comments={comments} perPage={COMMENTS_PER_PAGE} />\n        </Card>\n      </Col>\n      <Col span={8}>\n        <Card title=\"Notifies\">\n          <NotifiesList text=\"notifies\" comments={notifies} perPage={COMMENTS_PER_PAGE} />\n        </Card>\n      </Col>\n\n      <Col span={8}>\n        <Card title=\"Rounds by Notifies\">\n          Size: <Slider defaultValue={5} tooltipVisible value={roundSize} onChange={(v: number | any) => typeof v === 'number' && setRoundSize(v)} />\n          <pre>{filteredNotifies.map((n, i) => printRoundLine(n.from.name, i, roundSize))}</pre>\n        </Card>\n      </Col>\n    </>\n  )\n}\n\ninterface LiveVideoDashboardProps extends HasVideos {}\nconst LiveVideoDashboard: FC<LiveVideoDashboardProps> = (props) => {\n  const page = useContext(PageContext) as PageToken\n  const [persistedVideoData, setPersistedVideoData] = usePersistedVideoData()\n  const [, setLastSelectedVideo] = useLastSelectedVideoInfo()\n  const [loading, setLoading] = useState(true)\n  const { id } = useParams<{ id: string }>()\n  const { videos } = props\n  const video = videos.find((v) => v.id === id)\n\n  useEffect(() => {\n    const effect = async () => {\n      setLastSelectedVideo({page, id: video!.id})\n      if (video !== undefined && persistedVideoData[video.id] === true) {\n        setLoading(false)\n        return\n      }\n      if (video === undefined || video.status === 'LIVE') {\n        setLoading(false)\n        return\n      }\n\n      let comments = await FbApiCall<FacebookPaginatedResponse<VideoComment>>(`${video.id}/comments`, {\n        ...defaultMessageParams,\n        access_token: page.access_token\n      })\n      const allResults = await getAllResults(comments)\n      await batchInsertApiMessages(allResults, video.id, page.id)\n      setPersistedVideoData((prev) => ({ ...prev, [video.id]: true }))\n      setLoading(false)\n    }\n    effect()\n  }, [loading, setPersistedVideoData, setLastSelectedVideo, persistedVideoData, video, page])\n\n  if (video === undefined) {\n    return <Redirect to=\"/live_videos\" />\n  }\n  return (\n    <Content style={{ margin: '0 16px' }}>\n      <Breadcrumb style={{ margin: '16px 0' }}>\n        <Breadcrumb.Item>{page.name}</Breadcrumb.Item>\n        <Breadcrumb.Item>Live Videos</Breadcrumb.Item>\n        <Breadcrumb.Item>{video.title}</Breadcrumb.Item>\n      </Breadcrumb>\n\n      <div className=\"site-layout-background\" style={{ padding: 24, minHeight: 360 }}>\n        <Row gutter={16}>\n          <VideoHeader liveVideo={video} />\n        </Row>\n        <Row gutter={16}>{loading ? <Spin /> : <CommentsFeed video={video} />}</Row>\n      </div>\n    </Content>\n  )\n}\n\nexport const LiveVideosDashboard: FC = () => {\n  const { pageId } = useParams<{ pageId: string }>()\n  const [loadingVideos, pageData, videos] = useFacebookPage(pageId)\n  let match = useRouteMatch()\n  return (\n    <PageContext.Provider value={pageData}>\n      <Switch>\n        <Route path={`${match.path}/:id`}>{loadingVideos ? <Spin size=\"large\" /> : <LiveVideoDashboard videos={videos} />}</Route>\n        <Route path={match.path}>{loadingVideos ? <Spin size=\"large\" /> : <CurrentVideos videos={videos} />}</Route>\n      </Switch>\n    </PageContext.Provider>\n  )\n}\n\n\n","import { SettingOutlined } from '@ant-design/icons'\nimport { Breadcrumb, Button, Form, Input, Layout, Modal } from 'antd'\nimport React, { FC, useState } from 'react'\nimport { useChatBoxUrlState } from './util/streamlabs'\n\ninterface Values {\n  chatboxUrl: string\n}\n\ninterface CollectionCreateFormProps {\n  visible: boolean\n  onCreate: (values: Values) => void\n  onCancel: () => void\n}\n\nconst CollectionCreateForm: React.FC<CollectionCreateFormProps> = ({ visible, onCreate, onCancel }) => {\n  const [chatboxUrl] = useChatBoxUrlState()\n  const [form] = Form.useForm<Values>()\n  return (\n    <Modal\n      visible={visible}\n      title=\"Set Chatbox URL\"\n      okText=\"Set\"\n      cancelText=\"Cancel\"\n      onCancel={onCancel}\n      onOk={() => {\n        form\n          .validateFields()\n          .then((values) => {\n            form.resetFields()\n            onCreate(values as Values)\n          })\n          .catch((info) => {\n            console.log('Validate Failed:', info)\n          })\n      }}\n    >\n      <Form form={form} layout=\"vertical\" name=\"form_in_modal\" initialValues={{ chatboxUrl: chatboxUrl ?? '' }}>\n        <Form.Item name=\"chatboxUrl\" label=\"Chatbox URL\" rules={[{ required: true, message: 'Please input the chatbox url!' }]}>\n          <Input addonAfter={<SettingOutlined />} placeholder=\"https://streamlabs.com/widgets/chat-box/v1/XXXXXXXXXXXXXXXXXXXX\" />\n        </Form.Item>\n      </Form>\n    </Modal>\n  )\n}\n\nconst UpdateChatboxUrl = () => {\n  const [visible, setVisible] = useState(false)\n  const [chatboxUrl, setChatboxUrl] = useChatBoxUrlState()\n\n  const onCreate = (values: Values) => {\n    console.log('Received values of form: ', values)\n    setChatboxUrl(values.chatboxUrl)\n    setVisible(false)\n  }\n\n  return (\n    <>\n      <Button\n        type=\"primary\"\n        onClick={() => {\n          setVisible(true)\n        }}\n      >\n        Update Chatbox URL\n      </Button>\n      {chatboxUrl}\n      <CollectionCreateForm\n        visible={visible}\n        onCreate={onCreate}\n        onCancel={() => {\n          setVisible(false)\n        }}\n      />\n    </>\n  )\n}\n\nconst { Content } = Layout\n\nexport const PageSelector: FC = () => {\n  return (\n    <Content style={{ margin: '0 16px' }}>\n      <Breadcrumb style={{ margin: '16px 0' }}>\n        <Breadcrumb.Item>Home</Breadcrumb.Item>\n      </Breadcrumb>\n      <div className=\"site-layout-background\" style={{ padding: 24, minHeight: 360 }}>\n        <UpdateChatboxUrl />\n      </div>\n    </Content>\n  )\n}\n","import { chunk } from 'lodash'\nimport React, { FC } from 'react'\nimport { generateNotifies, generateNotifiesForRound } from '../live_videos/Notifies'\nimport { useVideoCustomState } from '../live_videos/util'\nimport { useLastSelectedVideoComments, useLastSelectedVideoInfo } from '../util/fb'\nimport './Rounds.css'\n\nexport const RoundsWidget: FC = () => {\n  const [videoInfo] = useLastSelectedVideoInfo()\n  const [comments] = useLastSelectedVideoComments()\n  const [videoState] = useVideoCustomState(videoInfo!.id)()\n  const notifies = generateNotifies(comments, videoInfo!.page.name)\n  const notifiesForRound = generateNotifiesForRound(notifies, videoState)\n  const separateRounds = chunk(notifiesForRound, videoState.roundSize)\n  return (\n    <div id=\"rounds-log\">\n      {separateRounds.map((round, i) => (\n        <div>\n          <h2>{i === 0 ? 'Pa\\'horita' : 'Pal\\'rato'}</h2>\n          <ul>\n          {round.map(n => (\n            <li>{n.from.name}</li>\n          ))}\n          </ul>\n        </div>\n      ))}\n    </div>\n  )\n}\n","import React, { FC } from 'react'\nimport { Redirect, Route, Switch, useRouteMatch } from 'react-router-dom'\nimport { RoundsWidget } from './RoundsWidget'\n\nexport const Widgets: FC = () => {\n  let match = useRouteMatch()\n\n  return (\n    <Switch>\n      <Switch>\n        <Route path={`${match.path}/rounds`}><RoundsWidget /></Route>\n        <Route path={match.path}>This could be a loverly widgets list</Route>\n        <Route path=\"*\"><Redirect to=\"/\" /></Route>\n      </Switch>\n    </Switch>\n  )\n}\n","import { FacebookOutlined, SaveOutlined, SettingOutlined } from '@ant-design/icons'\nimport { Breadcrumb, Button, Form, Input, Layout, Modal } from 'antd'\nimport Search from 'antd/lib/input/Search'\nimport React, { FC, useState } from 'react'\nimport { useParams } from 'react-router-dom'\nimport { useFacebookPage } from '../hooks/useFacebookPage'\nimport { PageContext } from '../PageContext'\n\ninterface Values {\n  chatboxUrl: string\n}\n\nconst GiveawayData = () => {\n  const [postUrl, setPostUrl] = useState<string>()\n  return (\n    <>\n      <Search prefix={<FacebookOutlined />} placeholder=\"Post Url\" defaultValue={postUrl} enterButton={<SaveOutlined />} size=\"large\" onSearch={(value) => setPostUrl(value)} />\n    </>\n  )\n}\n\nconst { Content } = Layout\n\nexport const AdvancedGiveaway: FC = () => {\n  const { pageId } = useParams<{ pageId: string }>()\n  const [, pageData] = useFacebookPage(pageId)\n\n  return (\n    <PageContext.Provider value={pageData}>\n      <Content style={{ margin: '0 16px' }}>\n        <Breadcrumb style={{ margin: '16px 0' }}>\n          <Breadcrumb.Item>{pageData?.name}</Breadcrumb.Item>\n          <Breadcrumb.Item>Advanced Giveaway</Breadcrumb.Item>\n        </Breadcrumb>\n        <div className=\"site-layout-background\" style={{ padding: 24, minHeight: 360 }}>\n          <GiveawayData />\n        </div>\n      </Content>\n    </PageContext.Provider>\n  )\n}\n","import React, { FC, useEffect, useState } from 'react'\nimport './App.css'\nimport { Layout, Menu, Spin } from 'antd'\nimport { DashboardOutlined, FacebookOutlined, GifOutlined, UnorderedListOutlined } from '@ant-design/icons'\nimport { BrowserRouter, Link, Route, Switch, useLocation } from 'react-router-dom'\nimport { LiveVideosDashboard } from './LiveVideoDashboard'\nimport { PageSelector } from './PageSelector'\nimport { PageToken, PageTokensResponse } from './definitions'\nimport { fetchStreamlabsConfig, isValidUrl, useChatBoxUrlState } from './util/streamlabs'\nimport { getPagesTokens } from './util/fb'\nimport { Widgets } from './widgets/Widgets'\nimport { AdvancedGiveaway } from './giveaway/AdvancedGiveaway'\n\nconst { Footer, Sider } = Layout\nconst { SubMenu } = Menu\n\nfunction getSelectedMenuItemKey(path: string) {\n  if (path.includes('/live_videos')) {\n    const [, pageId] = path.split('/')\n    return [`page-${pageId}-live_videos`]\n  }\n  if (path.includes('/advanced_giveaway')) {\n    const [, pageId] = path.split('/')\n    return [`page-${pageId}-advanced_giveaway`]\n  }\n  return ['home']\n}\n\ninterface SidebarProps {\n  showPageSelector: boolean\n}\n\nconst Sidebar: FC<SidebarProps> = ({ showPageSelector }) => {\n  const [loading, setLoading] = useState(true)\n  const [pages, setPages] = useState<PageToken[]>([])\n  useEffect(() => {\n    const effect = async () => {\n      if (showPageSelector) {\n        const tokensResponse: PageTokensResponse = await getPagesTokens()\n        setPages(tokensResponse.data)\n        setLoading(false)\n      }\n    }\n    effect()\n  }, [loading, showPageSelector])\n  const [collapsed, setCollapsed] = useState(false)\n  const onCollapse = () => setCollapsed(!collapsed)\n  const match = useLocation()\n\n  console.log(match)\n\n  return (\n    <Sider collapsible collapsed={collapsed} onCollapse={onCollapse}>\n      <div className=\"logo\" />\n      <Menu theme=\"dark\" defaultSelectedKeys={['home']} mode=\"inline\" selectedKeys={getSelectedMenuItemKey(match.pathname)}>\n        <Menu.Item key=\"home\" icon={<DashboardOutlined />}>\n          <Link to=\"/\">Dashboard</Link>\n        </Menu.Item>\n        {pages.map((p) => (\n          <SubMenu key={`page-${p.id}`} icon={<FacebookOutlined />} title={p.name}>\n            <Menu.Item key={`page-${p.id}-live_videos`} icon={<UnorderedListOutlined />}>\n              <Link to={`/${p.id}/live_videos`}>Live Videos</Link>\n            </Menu.Item>\n            <Menu.Item key={`page-${p.id}-advanced_giveaway`} icon={<GifOutlined />}>\n              <Link to={`/${p.id}/advanced_giveaway`}>Advanced Giveaway</Link>\n            </Menu.Item>\n          </SubMenu>\n        ))}\n      </Menu>\n    </Sider>\n  )\n}\n\nconst NormalPage: FC = () => {\n  const [chatboxUrl] = useChatBoxUrlState()\n  const [loggedIn, setLoggedIn] = useState(false)\n  useEffect(() => {\n    const effect = async () => {\n      if (loggedIn === false) {\n        try {\n          if (isValidUrl()) {\n            await fetchStreamlabsConfig()\n            setLoggedIn(true)\n          }\n        } catch (error) {\n          console.error(error)\n        }\n      }\n    }\n    effect()\n  }, [loggedIn, chatboxUrl])\n  return (\n    <Layout style={{ minHeight: '100vh' }}>\n      <Sidebar showPageSelector={loggedIn} />\n      <Layout className=\"site-layout\">\n        {loggedIn === false && typeof chatboxUrl === 'string' && <Spin />}\n        {loggedIn ? (\n          <Switch>\n            <Route path=\"/:pageId/live_videos\">\n              <LiveVideosDashboard />\n            </Route>\n            <Route path=\"/:pageId/advanced_giveaway\">\n              <AdvancedGiveaway />\n            </Route>\n            <Route path=\"/\">\n              <PageSelector />\n            </Route>\n          </Switch>\n        ) : (\n          <PageSelector />\n        )}\n\n        <Footer style={{ textAlign: 'center' }}>Ale Ornelas 2020</Footer>\n      </Layout>\n    </Layout>\n  )\n}\n\nconst App: FC = () => {\n  return (\n    <BrowserRouter basename=\"alegaming_site\">\n      <Switch>\n        <Route path=\"/widgets*\">\n          <Widgets />\n        </Route>\n        <Route path=\"*\">\n          <NormalPage />\n        </Route>\n      </Switch>\n    </BrowserRouter>\n  )\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\ndeclare global {\n  interface Window {\n    fbAsyncInit: () => void;\n  }\n}\n\nwindow.fbAsyncInit = function () {\n  FB.init({\n    appId: '662939310992071',\n    autoLogAppEvents: true,\n    xfbml: true,\n    cookie: true,\n    version: 'v8.0'\n  });\n  ReactDOM.render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>,\n    document.getElementById('root')\n  );\n};\n\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}