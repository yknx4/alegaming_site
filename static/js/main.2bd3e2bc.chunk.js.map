{"version":3,"sources":["util/streamlabs.ts","util/fb.ts","datastore/messagesDatabase.ts","util/messages.ts","live_videos/VideoHeader.tsx","PageContext.ts","live_videos/util.tsx","live_videos/Notifies.tsx","LiveVideoDashboard.tsx","PageSelector.tsx","widgets/RoundsWidget.tsx","widgets/Widgets.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["InvalidChatboxUrlError","Error","useChatBoxUrlState","createLocalStorageStateHook","STARTS","isValidUrl","storedUrl","JSON","parse","window","localStorage","getItem","console","log","error","startsWith","storedConfig","fetchStreamlabsConfig","a","fetch","headers","response","ok","json","config","getUserToken","streamlabsConfig","oauths","facebook_account","getUserId","usernames","getPagesTokens","pageAccessTokensResponse","getPageToken","id","tokens","data","find","t","usePersistedVideoData","useLastSelectedVideoInfo","useLastSelectedVideoComments","FbApiCall","path","params","method","Promise","resolve","reject","FB","api","errorResponse","message","getAllResults","results","allResults","push","undefined","paging","next","nextResponse","messagesDatabase","messages","version","stores","table","Dexie","videoCommentToDbMessage","videoId","pageId","toString","createdTime","created_time","user","from","name","userPicture","picture","url","userId","broadcastTimestamp","live_broadcast_timestamp","likeCount","like_count","dbMessageToVideoComment","Date","toISOString","batchInsertApiMessages","dbMessages","map","m","bulkAdd","Paragraph","Typography","Content","children","extraContent","style","flex","className","VideoHeader","props","liveVideo","history","useHistory","videoTime","DateTime","fromISO","creation_time","title","onBack","goBack","subTitle","toLocaleString","DATETIME_MED","tags","color","status","extra","key","type","target","href","permalink_url","avatar","src","video","icon","alt","width","description","PageContext","createContext","formatComments","comments","c","date","actions","author","content","datetime","TIME_24_WITH_SECONDS","toRelative","defaultVideoCustomState","roundSize","useVideoCustomState","memoize","notifyActions","state","setMessageState","down","onClick","createElement","ArrowUpOutlined","ArrowDownOutlined","hidden","React","EyeOutlined","EyeInvisibleOutlined","defaultMessageState","formatNotifies","videoState","setVideoState","messageId","messageState","prevState","currentMessageState","newMessageState","TIME_WITH_SECONDS","NotifiesList","perPage","text","useParams","useState","currentPage","setPage","offset","header","length","itemLayout","dataSource","slice","renderItem","item","current","onChange","p","total","showSizeChanger","defaultPageSize","showTotal","range","defaultCurrent","generateNotifiesForRound","notifies","currentState","withoutHiddenAndMoved","filter","n","movedDown","generateNotifies","pageName","reverse","uniqBy","includes","toLowerCase","Layout","defaultMessageParams","limit","live_filter","order","fields","VideoCard","span","LoadingOutlined","VideoCameraOutlined","bordered","hoverable","cover","Meta","CurrentVideos","videos","margin","Item","padding","minHeight","gutter","v","loadCachedMessages","where","toArray","existingMessages","CommentsList","CommentsFeed","page","useContext","loaded","setLoaded","setComments","setLastSelectedVideoComments","useEffect","composedSetComments","since","broadcast_start_time","effect","sortBy","toMillis","access_token","interval","setInterval","newComments","prev","clearInterval","filteredNotifies","defaultValue","tooltipVisible","value","setRoundSize","i","round","printRoundLine","LiveVideoDashboard","persistedVideoData","setPersistedVideoData","setLastSelectedVideo","loading","setLoading","to","LiveVideosDashboard","loadingVideos","setLoadingVideos","setVideos","pageData","setPageData","tokenItem","match","useRouteMatch","Provider","size","CollectionCreateForm","visible","onCreate","onCancel","chatboxUrl","Form","useForm","form","okText","cancelText","onOk","validateFields","then","values","resetFields","catch","info","layout","initialValues","label","rules","required","addonAfter","SettingOutlined","placeholder","UpdateChatboxUrl","setVisible","setChatboxUrl","PageSelector","RoundsWidget","videoInfo","notifiesForRound","separateRounds","chunk","Widgets","Footer","Sider","SubMenu","Menu","getSelectedMenuItemKey","split","Sidebar","showPageSelector","pages","setPages","tokensResponse","collapsed","setCollapsed","useLocation","collapsible","onCollapse","theme","defaultSelectedKeys","mode","selectedKeys","pathname","DashboardOutlined","FacebookOutlined","UnorderedListOutlined","NormalPage","loggedIn","setLoggedIn","textAlign","App","basename","Boolean","location","hostname","fbAsyncInit","init","appId","autoLogAppEvents","xfbml","cookie","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.2bd3e2bc.chunk.js","sourcesContent":["import { last } from 'lodash'\nimport { createLocalStorageStateHook } from 'use-local-storage-state'\nimport { StreamLabsConfig } from './streamlabs.definitions'\n\nexport class InvalidChatboxUrlError extends Error {}\n\nexport const useChatBoxUrlState = createLocalStorageStateHook<string>('chatboxUrl')\n\nconst STARTS = 'https://streamlabs.com/widgets/chat-box/v1/'\nexport function isValidUrl() {\n  const storedUrl = JSON.parse(window.localStorage.getItem('chatboxUrl') ?? '\"\"')\n  console.log('storedUrl', storedUrl)\n  if (storedUrl === null) {\n    console.error('storedUrl is null')\n    return false\n  }\n  if (!storedUrl.startsWith(STARTS)) {\n    console.error(`storedUrl <${storedUrl}> doesn't start with <${STARTS}>.`)\n    return false\n  }\n  return true\n}\n\nexport function getStreamlabsToken() {\n  return new Promise<string>((resolve, reject) => {\n    if (isValidUrl()) {\n      const url = JSON.parse(window.localStorage.getItem('chatboxUrl') ?? '\"\"') as string\n      resolve(last(url.split('/')))\n    } else {\n      reject(new InvalidChatboxUrlError('localStorage.chatboxUrl is empty or invalid.'))\n    }\n  })\n}\n\nlet storedConfig: StreamLabsConfig | null = null\nexport async function fetchStreamlabsConfig() {\n  if (storedConfig !== null) {\n    return storedConfig\n  }\n  const storedUrl = JSON.parse(window.localStorage.getItem('chatboxUrl') ?? '\"\"')\n  const response = await fetch(`https://murmuring-plateau-21894.herokuapp.com/?url=${storedUrl}`, {\n    headers: {\n      'x-token': 'eQ1z8bmURCR2Odtg4NR8M'\n    }\n  })\n  if (!response.ok) {\n    throw new InvalidChatboxUrlError('localStorage.chatboxUrl is empty or invalid.')\n  }\n  const config = (await response.json()) as StreamLabsConfig\n  storedConfig = config\n  return config\n}\n","import { createLocalStorageStateHook } from 'use-local-storage-state'\nimport { PageToken, PageTokensResponse } from \"../definitions\"\nimport { FacebookPaginatedResponse, VideoComment } from \"./fb.definitions\"\nimport { fetchStreamlabsConfig } from \"./streamlabs\"\n\nexport class InvalidFacebookUserTokenError extends Error {}\nexport class InvalidFacebookPageTokenError extends Error {}\n\n\nexport interface FacebookMe {\n  name: string\n}\n\nexport interface HasError {\n  error: any\n}\n\nexport async function getUserToken(): Promise<string> {\n  const streamlabsConfig = await fetchStreamlabsConfig()\n  return streamlabsConfig.oauths.facebook_account\n}\n\nexport async function getUserId(): Promise<string> {\n  const streamlabsConfig = await fetchStreamlabsConfig()\n  return streamlabsConfig.usernames.facebook_account\n}\n\nexport async function getPagesTokens(): Promise<PageTokensResponse> {\n  const pageAccessTokensResponse = await fetch(`https://graph.facebook.com/${await getUserId()}/accounts?access_token=${await getUserToken()}`)\n  return pageAccessTokensResponse.json() \n}\n\nexport async function getPageToken(id: string) {\n  const tokens = await getPagesTokens()\n  return tokens.data.find(t => t.id === id)\n}\n\nexport interface SelectedVideoInfo {\n  id: string,\n  page: PageToken\n}\n\nexport type PersistedVideoData = Record<string, boolean>\nexport const usePersistedVideoData = createLocalStorageStateHook<PersistedVideoData>('persistedVideoData', {})\nexport const useLastSelectedVideoInfo = createLocalStorageStateHook<SelectedVideoInfo>('lastSelectedVideoInfo')\nexport const useLastSelectedVideoComments = createLocalStorageStateHook<VideoComment[]>('lastSelectedVideoComments', [])\n\ninterface FbError {\n  error: string | unknown\n}\n\nexport interface FbParams {\n  access_token: string;\n  fields: string;\n  limit?: number\n  live_filter?: 'no_filter' | 'filter_low_quality'\n  order?: 'chronological' | 'reverse_chronological'\n  since?: string\n}\n\nexport function FbApiCall<T = unknown>(path: string, params: FbParams, method: \"get\" | \"post\" | \"delete\" = 'get'): Promise<T> {\n  return new Promise((resolve, reject) => {\n    FB.api(\n      path,\n      method,\n      params,\n      function (response: T | FbError | undefined) {\n        if(response == null) {\n          reject(new Error('Empty Response'))\n        }\n        if((response as FbError).error != null) {\n          const errorResponse = response as FbError\n          const message = typeof errorResponse.error === 'string' ? errorResponse.error : 'FB Api Error'\n          console.error(response)\n          reject(new Error(message))\n        }\n        resolve(response as T)\n      }\n    );\n  })\n}\n\nexport async function getAllResults<T extends FacebookPaginatedResponse>(results: T) {\n  let allResults: T['data'] = []\n\n  allResults.push(...results.data)\n  while (results.paging?.next !== undefined) {\n    const nextResponse = await fetch(results.paging.next)\n    results = await nextResponse.json()\n    allResults.push(...results.data)\n  }\n  return allResults\n}","import Dexie from 'dexie';\n\nexport interface Message {\n  id?: string;\n  message?: string;\n  createdTime?: string;\n  broadcastTimestamp?: number;\n  user?: string\n  userId?: string\n  userPicture?: string\n  pageId?: string\n  videoId?: string\n  likeCount?: number\n}\n\n//\n// Declare Database\n//\nclass MessageDatabase extends Dexie {\n  public messages: Dexie.Table<Message, string>; // id is number in this case\n\n  public constructor() {\n    super(\"MessageDatabase\");\n    this.version(5).stores({\n      messages: \"id,user,pageId,videoId,[message+user],[message+videoId],[message+userId]\"\n    });\n    this.messages = this.table(\"messages\");\n  }\n}\n\nexport const messagesDatabase = new MessageDatabase();","import { Message, messagesDatabase } from \"../datastore/messagesDatabase\";\nimport { VideoComment } from \"./fb.definitions\";\n\nfunction videoCommentToDbMessage(message: VideoComment, videoId: string, pageId: string): Required<Message> {\n  return {\n    id: message.id.toString(),\n    message: message.message,\n    createdTime: message.created_time,\n    user: message.from.name,\n    pageId,\n    userPicture: message.from.picture.data.url,\n    userId: message.from.id,\n    broadcastTimestamp: message.live_broadcast_timestamp,\n    videoId,\n    likeCount: message.like_count\n  }\n}\n\nexport function dbMessageToVideoComment(message: Message): VideoComment {\n  return {\n    id: message.id ?? '',\n    message: message.message ?? 'Unknown Message',\n    created_time: message.createdTime ?? new Date().toISOString(),\n    like_count: message.likeCount ?? 0,\n    live_broadcast_timestamp: message.broadcastTimestamp ?? 0,\n    from: {\n      id: message.userId ?? '',\n      name: message.user ?? 'Unknown Name',\n      picture: {\n        data: {\n          url: message.userPicture ?? 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxQHBhIRBxIOExAQEREVFxYVDRcVExIVGBIWFhUSFRUYHSggGh0lGxcVLTEhJSkrLi4uFx8zODMsNygtLisBCgoKDQ0NFQ4PEjEZFRkrKysrLTctLSsrKzctNysrLSsrNy0tKysrKy0rLSsrKysrKysrKystLSsrKysrKysrK//AABEIAOEA4QMBIgACEQEDEQH/xAAbAAEAAwEBAQEAAAAAAAAAAAAAAwQFBgIBB//EADUQAQABAgMDCQcEAwEAAAAAAAABAgMEBRESITETQVFhcYGhscEUIjI0kdHwQlKS4SRy8SP/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAMAwEAAhEDEQA/AP0wBpAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHqiiblWlETMg8vsRrOkcV2jLKqvjmmPGWjh8NTh6fcjf088mjMtZdXX8WlPbx+kJ4yr91U/xaQmqzpyqOaqf4o68rqj4KontjRqhowbuErtfHTOnTG+EDpVTE4Gm9GtO6rp6e2DUxij3dtTZr0uRv/N8PCgAAAAAAAAAAAAAAAAAA3MDh+Qsxr8U75+zHw9O3iKY6aodClABFAAAAAAQYzDxiLWnPHCWFMaTpPGHSMjNbWxfiqP1ecfkLBRAVAAAAAAAAAAAAAAAAFnL41xlPf5S3GHlvzlPf5S3EpABFAAAAAAFLNaNrC6/tmPt6rqtmM/4dWvV5wDDAaQAAAAAAAAAAAAAAABZy75ynv8pbjCwE6Yynt9JbqVQBAAAAAAAYmZVTOLmJmdI07t0Ntg46dcZV2+iwQAKgAAAAAAAAAAAAAAACfBRPtNMxE7qo5m8hwdGxhqYp6In6pkqgCAAAAAAAwMXExiatqJjWqebrb6pmdG1hJmeMaTH1WDFAVAAAAAAAAAAAAAAAAG5l9e3hKerd9Flm5Pc3VUz2+k+jSZqgAAAAAAAClm1ezhtP3THhv+y6yc2ubV6KY/THjKwUAFQAAAAAAAAAAAAAAABJh702LsVU/wDYbeFv+0WdqI047tWA08nubqqZ7fSfQo0gGVAAAAAAQYvEez2tdNd+nFh3bk3LkzVxmWhnFe+mmOufSPVmtRAAAAAAAAAAAAAAAAAABNhL3IYiJnhwnsQgOlidY3CllVya7GlX6Z0hdZUAAAABWzGuaMJOzz6R9QZWMu8tiZmOHCOyEANIAAAAAAAAAAAAAAAAAAAA2MpjTDT11T5RC6rZfTsYOnr1n6zqssqAAAAK2YxtYOru84WUeIp27FURz0zHgDngGkAAAAAAAAAAAAAAAAAAHqinbriKeMzoUUzXVpREzLVwGC5Gdq78XkC7TGzTERzQ+gyoAAAAADn8Vb5LEVR1+E8ETbx2E9op1p3VRw6+qWPctzaq0uRMS1EeAAAAAAAAAAAAAAB9iNqdKd8r2Hy2a997dHRz/wBAo007c6URMz1L+Hyyat9+dI6I4tGzZps06W4iPOe9ImmI7VmmzTpbiISAigAAAAAAADzctxcp0riJh6AZmIyznsT3T6Sz7lubdWlyJiXRvFy3F2nS5ETC6mOdGjiMs034ee6fSVCuiaKtK4mJ61HkAAAAAAH2N87gfFvC4Gq9vq92nxnshbwWA2I2r++ejmj+19NENjD02I/847+ee9MCKAAAAAAAAAAAAAAAAI71mm9TpciJ/OlIAyMVl8299r3o8Y+6i6VTxmBi/GtG6rwntXUYw9VUzRVMVRpMPKgAA0sqw2vv1933Z1MbVURHGZ0dFbo5O3EU8IjQo9AMqAAAAAAAAAAAAAAAAAAAAAAo5nh9u3t08aePXDIdLMaxvc9ft8leqp6J8OZYiMBRLhfmaP8AanzdACUgAigAAAAAAAAAAAAAAAAAAAAADEzL5yru8oBYKoCsv//Z'\n        }\n      }\n    }\n  }\n}\n\nexport async function batchInsertApiMessages(messages: VideoComment[], videoId: string, pageId: string) {\n  const dbMessages = messages.map((m) =>  videoCommentToDbMessage(m, videoId, pageId))\n  return await messagesDatabase.messages.bulkAdd(dbMessages)\n}\n\nexport async function insertOrUpdateMessage(message: VideoComment, videoId: string, pageId: string) {\n  const {id, ...allMessage} = videoCommentToDbMessage(message, videoId, pageId)\n  if(await messagesDatabase.messages.get(id) === undefined) {\n    return await messagesDatabase.messages.add({id, ...allMessage})\n  } else {\n    return await messagesDatabase.messages.update(id, allMessage)\n  }\n}\n","import { PageHeader, Button, Tag, Typography, Row } from 'antd';\nimport './VideoHeader.css'\nimport React, { FC } from 'react';\nimport { LiveVideo } from '../definitions';\nimport { useHistory } from 'react-router-dom';\nimport { DateTime } from 'luxon';\n\nconst { Paragraph } = Typography;\n\nconst Content = ({ children, extraContent }: any) => {\n  return (\n    <Row>\n      <div style={{ flex: 1 }}>{children}</div>\n      <div className=\"image\">{extraContent}</div>\n    </Row>\n  );\n};\n\nexport interface VideoHeaderProps {\n  liveVideo: LiveVideo\n}\n\nexport const VideoHeader: FC<VideoHeaderProps> = (props) => {\n  const { liveVideo } = props\n  const history = useHistory()\n  const videoTime = DateTime.fromISO(liveVideo.creation_time)\n  return (\n    <PageHeader\n      title={liveVideo.title}\n      onBack={() => history.goBack()}\n      className=\"site-page-header\"\n      subTitle={videoTime.toLocaleString(DateTime.DATETIME_MED)}\n      tags={<Tag color=\"blue\">{liveVideo.status}</Tag>}\n      extra={[\n        <Button key=\"1\" type=\"primary\" target=\"_blank\" href={`https://facebook.com/${liveVideo.permalink_url}`}>\n          Open\n      </Button>\n      ]}\n      avatar={{ src: liveVideo.video.icon }}\n    >\n      <Content\n        extraContent={\n          <img\n            src={liveVideo.video.picture}\n            alt={liveVideo.title}\n            width=\"100%\"\n          />\n        }\n      >\n        <Paragraph>\n          {liveVideo.description}\n        </Paragraph>\n      </Content>\n    </PageHeader>\n  )\n}","import { createContext } from \"react\";\nimport { PageToken } from \"./definitions\";\n\nexport const PageContext = createContext<PageToken | undefined>(undefined)","import { Tooltip } from \"antd\"\nimport React from \"react\"\nimport { createLocalStorageStateHook } from 'use-local-storage-state'\nimport { memoize } from \"lodash\"\nimport { DateTime } from \"luxon\"\nimport { VideoComment } from \"../util/fb.definitions\"\n\nexport function formatComments(comments: VideoComment[]) {\n  return comments.map((c) => {\n    const date = DateTime.fromISO(c.created_time)\n    return {\n      actions: [],\n      author: c.from.name,\n      avatar: c.from.picture.data.url,\n      content: <p>{c.message}</p>,\n      datetime: (\n        <Tooltip title={date.toLocaleString(DateTime.TIME_24_WITH_SECONDS)}>\n          <span>{date.toRelative()}</span>\n        </Tooltip>\n      )\n    }\n  })\n}\nexport interface CustomVideoState {\n  messages: Record<string, CustomMessageState>\n  roundSize: number\n}\nexport interface CustomMessageState {\n  hidden: boolean\n  down: boolean\n}\nexport const defaultVideoCustomState: CustomVideoState = {\n  roundSize: 5,\n  messages: {}\n}\nexport const useVideoCustomState = memoize((videoId: string) => createLocalStorageStateHook<CustomVideoState>(`custom-video-settings-${videoId}`, defaultVideoCustomState))\n\nexport const COMMENTS_PER_PAGE = 10","import { ArrowDownOutlined, ArrowUpOutlined, EyeInvisibleOutlined, EyeOutlined } from '@ant-design/icons'\nimport { List, Pagination, Comment, Tooltip } from 'antd'\nimport { uniqBy, reverse } from 'lodash'\nimport { DateTime } from 'luxon'\nimport React, { createElement, FC, useState } from 'react'\nimport { useParams } from 'react-router-dom'\nimport { VideoComment } from '../util/fb.definitions'\nimport { COMMENTS_PER_PAGE, CustomMessageState, CustomVideoState, useVideoCustomState } from './util'\n\ninterface NotifiesListProps {\n  comments: VideoComment[]\n  perPage: number\n  text: string\n}\n\nfunction notifyActions(state: CustomMessageState, setMessageState: (messageState: Partial<CustomMessageState>) => void) {\n  return [\n    <Tooltip key=\"comment-basic-position\" title={state.down ? 'Move Up' : 'Move Down'}>\n      <span\n        onClick={() => {\n          setMessageState({ down: !state.down })\n        }}\n      >\n        {createElement(state.down ? ArrowUpOutlined : ArrowDownOutlined)}\n      </span>\n    </Tooltip>,\n    <Tooltip key=\"comment-basic-hide\" title={state.hidden ? 'Show' : 'Hide'}>\n      <span\n        onClick={() => {\n          setMessageState({ hidden: !state.hidden })\n        }}\n      >\n        {React.createElement(state.hidden ? EyeOutlined : EyeInvisibleOutlined)}\n      </span>\n    </Tooltip>\n  ]\n}\n\nexport const defaultMessageState: CustomMessageState = { hidden: false, down: false }\n\nfunction formatNotifies(\n  comments: VideoComment[],\n  videoState: CustomVideoState,\n  setVideoState: React.Dispatch<React.SetStateAction<CustomVideoState>>\n) {\n  const setMessageState = (messageId: string) => (messageState: Partial<CustomMessageState>) => {\n    setVideoState((prevState) => {\n      const currentMessageState = prevState.messages[messageId] ?? defaultMessageState\n      const newMessageState = { ...currentMessageState, ...messageState }\n      return { ...prevState, messages: { ...prevState.messages, [messageId]: newMessageState } }\n    })\n  }\n  return comments.map((c) => {\n    const date = DateTime.fromISO(c.created_time)\n    const messageState = videoState.messages[c.id] ?? defaultMessageState\n    return {\n      actions: notifyActions(messageState, setMessageState(c.id)),\n      author: c.from.name,\n      avatar: c.from.picture.data.url,\n      content: <p>{c.message}</p>,\n      datetime: (\n        <Tooltip title={date.toLocaleString(DateTime.TIME_WITH_SECONDS)}>\n          <span>{date.toRelative()}</span>\n        </Tooltip>\n      )\n    }\n  })\n}\n\nexport const NotifiesList: FC<NotifiesListProps> = (props) => {\n  const { comments, perPage, text } = props\n  const { id } = useParams<{ id: string }>()\n  const [currentPage, setPage] = useState(1)\n  const [videoState, setVideoState] = useVideoCustomState(id)()\n  const offset = (currentPage - 1) * perPage\n  return (\n    <>\n      <List\n        className=\"comment-list\"\n        header={`${comments.length} ${text}`}\n        itemLayout=\"horizontal\"\n        dataSource={formatNotifies(comments.slice(offset, offset + perPage), videoState, setVideoState)}\n        renderItem={(item) => (\n          <li>\n            <Comment actions={item.actions} author={item.author} avatar={item.avatar} content={item.content} datetime={item.datetime} />\n          </li>\n        )}\n      />\n      <Pagination\n        current={currentPage}\n        onChange={(p) => setPage(p)}\n        total={comments.length}\n        showSizeChanger={false}\n        defaultPageSize={COMMENTS_PER_PAGE}\n        showTotal={(total, range) => `${range[0]}-${range[1]} of ${total} ${text}`}\n        defaultCurrent={1}\n      />\n    </>\n  )\n}\n\nexport function generateNotifiesForRound(notifies: VideoComment[], currentState: CustomVideoState) {\n  const withoutHiddenAndMoved = notifies\n    .filter((n) => !(currentState.messages[n.id] ?? defaultMessageState).hidden)\n    .filter((n) => !(currentState.messages[n.id] ?? defaultMessageState).down)\n  const movedDown = notifies.filter((n) => (currentState.messages[n.id] ?? defaultMessageState).down)\n  return [...withoutHiddenAndMoved, ...movedDown]\n}\n\nexport function generateNotifies(comments: VideoComment[], pageName: string) {\n  return reverse(\n    uniqBy(\n      comments.filter((c) => c.message.includes('!') && c.message.toLowerCase().includes('notify') && (c.from.name !== pageName ?? 'UNKNOWN PAGE')),\n      (c) => c.from.id\n    )\n  )\n}\n","import React, { FC, useContext, useEffect, useState } from 'react'\nimport { Card, Col, List, Row, Comment, Pagination, Layout, Spin, Slider } from 'antd'\nimport './App.css'\nimport { Breadcrumb } from 'antd'\nimport { LoadingOutlined, VideoCameraOutlined } from '@ant-design/icons'\nimport { LiveVideo, LiveVideos, PageToken } from './definitions'\nimport { sortBy, uniqBy } from 'lodash'\nimport { Redirect, Route, Switch, useHistory, useParams, useRouteMatch } from 'react-router-dom'\nimport {\n  FbApiCall,\n  FbParams,\n  getAllResults,\n  getPageToken,\n  useLastSelectedVideoInfo,\n  useLastSelectedVideoComments,\n  usePersistedVideoData\n} from './util/fb'\nimport { batchInsertApiMessages, dbMessageToVideoComment } from './util/messages'\nimport { messagesDatabase } from './datastore/messagesDatabase'\nimport { VideoHeader } from './live_videos/VideoHeader'\nimport { PageContext } from './PageContext'\nimport { FacebookPaginatedResponse, VideoComment } from './util/fb.definitions'\nimport { COMMENTS_PER_PAGE, formatComments, useVideoCustomState } from './live_videos/util'\nimport { generateNotifies, generateNotifiesForRound, NotifiesList } from './live_videos/Notifies'\nimport { DateTime } from 'luxon'\nconst { Content } = Layout\n\nconst messagesParams = 'from{name,id,picture},message,id,created_time,like_count,live_broadcast_timestamp'\nconst defaultMessageParams: Omit<FbParams, 'access_token'> = {\n  limit: 100,\n  live_filter: 'no_filter',\n  order: 'reverse_chronological',\n  fields: messagesParams\n}\n\nconst VideoCard: FC<{ video: LiveVideo; span?: number; onClick?: ((selected: LiveVideo) => void) | undefined }> = (props) => {\n  const { video, span = 8, onClick = () => {} } = props\n  const icon = video.status === 'LIVE' ? <LoadingOutlined /> : <VideoCameraOutlined />\n  return (\n    <Col span={span}>\n      <Card\n        bordered={false}\n        hoverable={video.status === 'LIVE'}\n        onClick={() => onClick(video)}\n        cover={<img alt={video.title} src={video.video.picture} />}\n      >\n        <Card.Meta title={video.title} description={video.description} avatar={icon} />\n      </Card>\n    </Col>\n  )\n}\n\ninterface HasVideos {\n  videos: LiveVideo[]\n}\n\ninterface CurrentVideosProp extends HasVideos {}\nconst VIDEOS_PER_PAGE = 6\nconst CurrentVideos: FC<CurrentVideosProp> = (props) => {\n  const { videos } = props\n  const [currentPage, setPage] = useState(1)\n  const history = useHistory()\n  const offset = (currentPage - 1) * VIDEOS_PER_PAGE\n  const { pageId } = useParams<{ pageId: string }>()\n  return (\n    <Content style={{ margin: '0 16px' }}>\n      <Breadcrumb style={{ margin: '16px 0' }}>\n        <Breadcrumb.Item>LiaKumStreams</Breadcrumb.Item>\n        <Breadcrumb.Item>Live Videos</Breadcrumb.Item>\n      </Breadcrumb>\n      <div className=\"site-layout-background\" style={{ padding: 24, minHeight: 360 }}>\n        <Row gutter={16}>\n          {videos.slice(offset, offset + VIDEOS_PER_PAGE).map((v) => (\n            <VideoCard key={`video-${v.id}`} video={v} onClick={(v) => history.push(`/${pageId}/live_videos/${v.id}`)} />\n          ))}\n        </Row>\n        <Row gutter={16}>\n          <Pagination\n            current={currentPage}\n            onChange={(p) => setPage(p)}\n            total={videos.length}\n            showSizeChanger={false}\n            defaultPageSize={VIDEOS_PER_PAGE}\n            defaultCurrent={1}\n          />\n        </Row>\n      </div>\n    </Content>\n  )\n}\n\nasync function loadCachedMessages(videoId: string) {\n  const existingMessages = await messagesDatabase.messages.where({ videoId: videoId }).toArray()\n  return existingMessages.map(dbMessageToVideoComment)\n}\n\ninterface CommentsListProps {\n  comments: VideoComment[]\n  perPage: number\n  text: string\n}\nconst CommentsList: FC<CommentsListProps> = (props) => {\n  const { comments, perPage, text } = props\n  const [currentPage, setPage] = useState(1)\n  const offset = (currentPage - 1) * perPage\n  return (\n    <>\n      <List\n        className=\"comment-list\"\n        header={`${comments.length} ${text}`}\n        itemLayout=\"horizontal\"\n        dataSource={formatComments(comments.slice(offset, offset + perPage))}\n        renderItem={(item) => (\n          <li>\n            <Comment actions={item.actions} author={item.author} avatar={item.avatar} content={item.content} datetime={item.datetime} />\n          </li>\n        )}\n      />\n      <Pagination\n        current={currentPage}\n        onChange={(p) => setPage(p)}\n        total={comments.length}\n        showSizeChanger={false}\n        defaultPageSize={COMMENTS_PER_PAGE}\n        showTotal={(total, range) => `${range[0]}-${range[1]} of ${total} ${text}`}\n        defaultCurrent={1}\n      />\n    </>\n  )\n}\n\nfunction printRoundLine(name: string, round: number, roundSize: number) {\n  return `${round % roundSize === 0 ? '----Ronda----\\n' : ''}${name}\\n`\n}\n\nconst CommentsFeed: FC<{ video: LiveVideo }> = (props) => {\n  const { video } = props\n  const page = useContext(PageContext) as PageToken\n  const [loaded, setLoaded] = useState(false)\n  const [comments, setComments] = useState<VideoComment[]>([])\n  const [, setLastSelectedVideoComments] = useLastSelectedVideoComments()\n  const [videoState, setVideoState] = useVideoCustomState(video.id)()\n  const { pageId } = useParams<{ pageId: string }>()\n  const { roundSize } = videoState\n  const setRoundSize = (roundSize: number) => setVideoState((prev) => ({ ...prev, roundSize }))\n  useEffect(() => {\n    const composedSetComments: React.Dispatch<React.SetStateAction<VideoComment[]>> = (params) => {\n      setLastSelectedVideoComments(params)\n      return setComments(params)\n    }\n    let since = video.broadcast_start_time\n    const effect = async () => {\n      if (video.status !== 'LIVE') {\n        composedSetComments(sortBy(await loadCachedMessages(video.id), (m) => DateTime.fromISO(m.created_time).toMillis()).reverse())\n        setLoaded(true)\n        return\n      }\n      let comments = await FbApiCall<FacebookPaginatedResponse<VideoComment>>(`${video.id}/comments`, {\n        ...defaultMessageParams,\n        access_token: page.access_token\n      })\n      const allResults = await getAllResults(comments)\n      composedSetComments(allResults)\n      if (allResults.length > 0) {\n        since = allResults[0].created_time\n      }\n      setLoaded(true)\n      return\n    }\n    const interval = setInterval(async () => {\n      const newComments = await FbApiCall<FacebookPaginatedResponse<VideoComment>>(`${video.id}/comments`, {\n        ...defaultMessageParams,\n        since,\n        access_token: page.access_token\n      })\n      if (newComments.data.length > 0) {\n        since = newComments.data[0].created_time\n      }\n      composedSetComments((prev) => uniqBy([...newComments.data, ...prev], 'id'))\n    }, 5000)\n    effect()\n    return () => clearInterval(interval)\n  }, [loaded, video.id, pageId, video.status, page.access_token, video.broadcast_start_time, setLastSelectedVideoComments])\n\n  const notifies = generateNotifies(comments, page.name)\n\n  const filteredNotifies = generateNotifiesForRound(notifies, videoState)\n\n  return (\n    <>\n      <Col span={8}>\n        <Card title=\"Comments\">\n          <CommentsList text=\"replies\" comments={comments} perPage={COMMENTS_PER_PAGE} />\n        </Card>\n      </Col>\n      <Col span={8}>\n        <Card title=\"Notifies\">\n          <NotifiesList text=\"notifies\" comments={notifies} perPage={COMMENTS_PER_PAGE} />\n        </Card>\n      </Col>\n\n      <Col span={8}>\n        <Card title=\"Rounds by Notifies\">\n          Size: <Slider defaultValue={5} tooltipVisible value={roundSize} onChange={(v: number | any) => typeof v === 'number' && setRoundSize(v)} />\n          <pre>{filteredNotifies.map((n, i) => printRoundLine(n.from.name, i, roundSize))}</pre>\n        </Card>\n      </Col>\n    </>\n  )\n}\n\ninterface LiveVideoDashboardProps extends HasVideos {}\nconst LiveVideoDashboard: FC<LiveVideoDashboardProps> = (props) => {\n  const page = useContext(PageContext) as PageToken\n  const [persistedVideoData, setPersistedVideoData] = usePersistedVideoData()\n  const [, setLastSelectedVideo] = useLastSelectedVideoInfo()\n  const [loading, setLoading] = useState(true)\n  const { id } = useParams<{ id: string }>()\n  const { videos } = props\n  const video = videos.find((v) => v.id === id)\n\n  useEffect(() => {\n    const effect = async () => {\n      setLastSelectedVideo({page, id: video!.id})\n      if (video !== undefined && persistedVideoData[video.id] === true) {\n        setLoading(false)\n        return\n      }\n      if (video === undefined || video.status === 'LIVE') {\n        setLoading(false)\n        return\n      }\n\n      let comments = await FbApiCall<FacebookPaginatedResponse<VideoComment>>(`${video.id}/comments`, {\n        ...defaultMessageParams,\n        access_token: page.access_token\n      })\n      const allResults = await getAllResults(comments)\n      await batchInsertApiMessages(allResults, video.id, page.id)\n      setPersistedVideoData((prev) => ({ ...prev, [video.id]: true }))\n      setLoading(false)\n    }\n    effect()\n  }, [loading, setPersistedVideoData, setLastSelectedVideo, persistedVideoData, video, page])\n\n  if (video === undefined) {\n    return <Redirect to=\"/live_videos\" />\n  }\n  return (\n    <Content style={{ margin: '0 16px' }}>\n      <Breadcrumb style={{ margin: '16px 0' }}>\n        <Breadcrumb.Item>LiaKumStreams</Breadcrumb.Item>\n        <Breadcrumb.Item>Live Videos</Breadcrumb.Item>\n        <Breadcrumb.Item>{video.title}</Breadcrumb.Item>\n      </Breadcrumb>\n\n      <div className=\"site-layout-background\" style={{ padding: 24, minHeight: 360 }}>\n        <Row gutter={16}>\n          <VideoHeader liveVideo={video} />\n        </Row>\n        <Row gutter={16}>{loading ? <Spin /> : <CommentsFeed video={video} />}</Row>\n      </div>\n    </Content>\n  )\n}\n\nexport const LiveVideosDashboard: FC = () => {\n  const { pageId } = useParams<{ pageId: string }>()\n  const [loadingVideos, setLoadingVideos] = useState(true)\n  const [videos, setVideos] = useState<LiveVideo[]>([])\n  const [pageData, setPageData] = useState<PageToken>()\n  useEffect(() => {\n    if (loadingVideos === true) {\n      const effect = async () => {\n        const tokenItem = await getPageToken(pageId)\n        FB.api(\n          `/${pageId}/live_videos`,\n          'get',\n          {\n            access_token: tokenItem?.access_token,\n            fields: 'status,creation_time,broadcast_start_time,description,embed_html,id,live_views,title,permalink_url,video{id,picture,icon}'\n          },\n          function (response: LiveVideos) {\n            setLoadingVideos(true)\n            setVideos(response.data)\n            setPageData(tokenItem)\n            setLoadingVideos(false)\n          }\n        )\n      }\n      effect()\n    }\n  }, [loadingVideos, pageId])\n  let match = useRouteMatch()\n  return (\n    <PageContext.Provider value={pageData}>\n      <Switch>\n        <Route path={`${match.path}/:id`}>{loadingVideos ? <Spin size=\"large\" /> : <LiveVideoDashboard videos={videos} />}</Route>\n        <Route path={match.path}>{loadingVideos ? <Spin size=\"large\" /> : <CurrentVideos videos={videos} />}</Route>\n      </Switch>\n    </PageContext.Provider>\n  )\n}\n\n\n","import { SettingOutlined } from '@ant-design/icons'\nimport { Breadcrumb, Button, Form, Input, Layout, Modal } from 'antd'\nimport React, { FC, useState } from 'react'\nimport { useChatBoxUrlState } from './util/streamlabs'\n\ninterface Values {\n  chatboxUrl: string\n}\n\ninterface CollectionCreateFormProps {\n  visible: boolean\n  onCreate: (values: Values) => void\n  onCancel: () => void\n}\n\nconst CollectionCreateForm: React.FC<CollectionCreateFormProps> = ({ visible, onCreate, onCancel }) => {\n  const [chatboxUrl] = useChatBoxUrlState()\n  const [form] = Form.useForm<Values>()\n  return (\n    <Modal\n      visible={visible}\n      title=\"Set Chatbox URL\"\n      okText=\"Set\"\n      cancelText=\"Cancel\"\n      onCancel={onCancel}\n      onOk={() => {\n        form\n          .validateFields()\n          .then((values) => {\n            form.resetFields()\n            onCreate(values as Values)\n          })\n          .catch((info) => {\n            console.log('Validate Failed:', info)\n          })\n      }}\n    >\n      <Form form={form} layout=\"vertical\" name=\"form_in_modal\" initialValues={{ chatboxUrl: chatboxUrl ?? '' }}>\n        <Form.Item name=\"chatboxUrl\" label=\"Chatbox URL\" rules={[{ required: true, message: 'Please input the chatbox url!' }]}>\n          <Input addonAfter={<SettingOutlined />} placeholder=\"https://streamlabs.com/widgets/chat-box/v1/XXXXXXXXXXXXXXXXXXXX\" />\n        </Form.Item>\n      </Form>\n    </Modal>\n  )\n}\n\nconst UpdateChatboxUrl = () => {\n  const [visible, setVisible] = useState(false)\n  const [chatboxUrl, setChatboxUrl] = useChatBoxUrlState()\n\n  const onCreate = (values: Values) => {\n    console.log('Received values of form: ', values)\n    setChatboxUrl(values.chatboxUrl)\n    setVisible(false)\n  }\n\n  return (\n    <>\n      <Button\n        type=\"primary\"\n        onClick={() => {\n          setVisible(true)\n        }}\n      >\n        Update Chatbox URL\n      </Button>\n      {chatboxUrl}\n      <CollectionCreateForm\n        visible={visible}\n        onCreate={onCreate}\n        onCancel={() => {\n          setVisible(false)\n        }}\n      />\n    </>\n  )\n}\n\nconst { Content } = Layout\n\nexport const PageSelector: FC = () => {\n  return (\n    <Content style={{ margin: '0 16px' }}>\n      <Breadcrumb style={{ margin: '16px 0' }}>\n        <Breadcrumb.Item>Home</Breadcrumb.Item>\n      </Breadcrumb>\n      <div className=\"site-layout-background\" style={{ padding: 24, minHeight: 360 }}>\n        <UpdateChatboxUrl />\n      </div>\n    </Content>\n  )\n}\n","import { chunk } from 'lodash'\nimport React, { FC } from 'react'\nimport { generateNotifies, generateNotifiesForRound } from '../live_videos/Notifies'\nimport { useVideoCustomState } from '../live_videos/util'\nimport { useLastSelectedVideoComments, useLastSelectedVideoInfo } from '../util/fb'\nimport './Rounds.css'\n\nexport const RoundsWidget: FC = () => {\n  const [videoInfo] = useLastSelectedVideoInfo()\n  const [comments] = useLastSelectedVideoComments()\n  const [videoState] = useVideoCustomState(videoInfo!.id)()\n  const notifies = generateNotifies(comments, videoInfo!.page.name)\n  const notifiesForRound = generateNotifiesForRound(notifies, videoState)\n  const separateRounds = chunk(notifiesForRound, videoState.roundSize)\n  return (\n    <div id=\"rounds-log\">\n      {separateRounds.map((round, i) => (\n        <div>\n          <h2>{i === 0 ? 'Pa\\'horita' : 'Pal\\'rato'}</h2>\n          <ul>\n          {round.map(n => (\n            <li>{n.from.name}</li>\n          ))}\n          </ul>\n        </div>\n      ))}\n    </div>\n  )\n}\n","import React, { FC } from 'react'\nimport { Redirect, Route, Switch, useRouteMatch } from 'react-router-dom'\nimport { RoundsWidget } from './RoundsWidget'\n\nexport const Widgets: FC = () => {\n  let match = useRouteMatch()\n\n  return (\n    <Switch>\n      <Switch>\n        <Route path={`${match.path}/rounds`}><RoundsWidget /></Route>\n        <Route path={match.path}>This could be a loverly widgets list</Route>\n        <Route path=\"*\"><Redirect to=\"/\" /></Route>\n      </Switch>\n    </Switch>\n  )\n}\n","import React, { FC, useEffect, useState } from 'react'\nimport './App.css'\nimport { Layout, Menu, Spin } from 'antd'\nimport { DashboardOutlined, FacebookOutlined, UnorderedListOutlined } from '@ant-design/icons'\nimport { BrowserRouter, Link, Route, Switch, useLocation } from 'react-router-dom'\nimport { LiveVideosDashboard } from './LiveVideoDashboard'\nimport { PageSelector } from './PageSelector'\nimport { PageToken, PageTokensResponse } from './definitions'\nimport { fetchStreamlabsConfig, isValidUrl, useChatBoxUrlState } from './util/streamlabs'\nimport { getPagesTokens } from './util/fb'\nimport { Widgets } from './widgets/Widgets'\n\nconst { Footer, Sider } = Layout\nconst { SubMenu } = Menu\n\nfunction getSelectedMenuItemKey(path: string) {\n  if (path.includes('/live_videos')) {\n    const [, pageId] = path.split('/')\n    return [`page-${pageId}-live_videos`]\n  }\n  return ['home']\n}\n\ninterface SidebarProps {\n  showPageSelector: boolean\n}\n\nconst Sidebar: FC<SidebarProps> = ({ showPageSelector }) => {\n  const [loading, setLoading] = useState(true)\n  const [pages, setPages] = useState<PageToken[]>([])\n  useEffect(() => {\n    const effect = async () => {\n      if (showPageSelector) {\n        const tokensResponse: PageTokensResponse = await getPagesTokens()\n        setPages(tokensResponse.data)\n        setLoading(false)\n      }\n    }\n    effect()\n  }, [loading, showPageSelector])\n  const [collapsed, setCollapsed] = useState(false)\n  const onCollapse = () => setCollapsed(!collapsed)\n  const match = useLocation()\n\n  console.log(match)\n\n  return (\n    <Sider collapsible collapsed={collapsed} onCollapse={onCollapse}>\n      <div className=\"logo\" />\n      <Menu theme=\"dark\" defaultSelectedKeys={['home']} mode=\"inline\" selectedKeys={getSelectedMenuItemKey(match.pathname)}>\n        <Menu.Item key=\"home\" icon={<DashboardOutlined />}>\n          <Link to=\"/\">Dashboard</Link>\n        </Menu.Item>\n        {pages.map((p) => (\n          <SubMenu key={`page-${p.id}`} icon={<FacebookOutlined />} title={p.name}>\n            <Menu.Item key={`page-${p.id}-live_videos`} icon={<UnorderedListOutlined />}>\n              <Link to={`/${p.id}/live_videos`}>Live Videos</Link>\n            </Menu.Item>\n          </SubMenu>\n        ))}\n      </Menu>\n    </Sider>\n  )\n}\n\nconst NormalPage: FC = () => {\n  const [chatboxUrl] = useChatBoxUrlState()\n  const [loggedIn, setLoggedIn] = useState(false)\n  useEffect(() => {\n    const effect = async () => {\n      if (loggedIn === false) {\n        try {\n          if (isValidUrl()) {\n            await fetchStreamlabsConfig()\n            setLoggedIn(true)\n          }\n        } catch (error) {\n          console.error(error)\n        }\n      }\n    }\n    effect()\n  }, [loggedIn, chatboxUrl])\n  return (\n    <Layout style={{ minHeight: '100vh' }}>\n      <Sidebar showPageSelector={loggedIn} />\n      <Layout className=\"site-layout\">\n        {loggedIn === false && typeof chatboxUrl === 'string' && <Spin />}\n        {loggedIn ? (\n          <Switch>\n            <Route path=\"/:pageId/live_videos\">\n              <LiveVideosDashboard />\n            </Route>\n            <Route path=\"/\">\n              <PageSelector />\n            </Route>\n          </Switch>\n        ) : (\n          <PageSelector />\n        )}\n\n        <Footer style={{ textAlign: 'center' }}>Ale Ornelas 2020</Footer>\n      </Layout>\n    </Layout>\n  )\n}\n\nconst App: FC = () => {\n  return (\n    <BrowserRouter basename=\"alegaming_site\">\n      <Switch>\n        <Route path=\"/widgets*\">\n          <Widgets />\n        </Route>\n        <Route path=\"*\">\n          <NormalPage />\n        </Route>\n      </Switch>\n    </BrowserRouter>\n  )\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\ndeclare global {\n  interface Window {\n    fbAsyncInit: () => void;\n  }\n}\n\nwindow.fbAsyncInit = function () {\n  FB.init({\n    appId: '662939310992071',\n    autoLogAppEvents: true,\n    xfbml: true,\n    cookie: true,\n    version: 'v8.0'\n  });\n  ReactDOM.render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>,\n    document.getElementById('root')\n  );\n};\n\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}